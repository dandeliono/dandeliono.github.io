{"title":"Linux 下 journal 日志清理","uid":"1d828a50cab789d76b35014d3e9c8893","slug":"LINUX/Linux 下 journal 日志清理","date":"2023-02-22T11:56:19.000Z","updated":"2025-09-30T03:26:32.755Z","comments":true,"path":"api/articles/LINUX/Linux 下 journal 日志清理.json","keywords":"XuGuangSheng","cover":"/covers/linux-journal.jpg","content":"<h1 id=\"Linux-下-journal-日志清理\"><a href=\"#Linux-下-journal-日志清理\" class=\"headerlink\" title=\"Linux 下 journal 日志清理\"></a>Linux 下 journal 日志清理</h1><p>Linux 在运行的过程中会产生很多日志文件，一般存放在 <code>/var/log</code> 目录下，而其中 <code>journal</code> 目录中存放的是 <code>journald</code> daemon 程序生成的日志，其中包括了所有 kernel, initrd, services 等等产生的日志。这些日志在系统发生状况排查问题的时候非常有用。</p>\n<p><code>jounrnald</code> daemon 程序会收集系统运行的日志并存储到二进制文件中。为了查看这些二进制文件通常会使用到 <code>journalctl</code> 命令。但是默认情况下这些日志文件会占用磁盘空间的 10%，而大部分情况下这些日志文件是不需要查看的。所以可以配置减小一些 journal 日志的占用。</p>\n<p>默认的日志文件保存在 <code>/var/log/journal</code> 下，可以使用 <code>du</code> 查看。不过我个人推荐使用可视化的 <code>gdu</code> 来 <a href=\"https://einverne.github.io/post/2021/07/gdu-fast-disk-usage-analyzer.html\">查看</a> 。</p>\n<ul>\n<li><code>du -sh /var/log/journal</code> 查看占用磁盘空间</li>\n</ul>\n<p>可以使用 <code>journalctl</code> 命令查看日志占用：</p>\n<figure class=\"highlight mipsasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo <span class=\"keyword\">journalctl </span>--<span class=\"keyword\">disk-usage </span></span><br></pre></td></tr></table></figure>\n\n<p>如果要去清理 journal 日志，可以先执行 <code>rotate</code> 命令：</p>\n<figure class=\"highlight mipsasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">journalctl </span>--rotate &amp;&amp; \\</span><br><span class=\"line\">systemctl restart systemd-<span class=\"keyword\">journald </span></span><br></pre></td></tr></table></figure>\n\n<p>删除两天前的日志：</p>\n<figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">journalctl --vacuum-<span class=\"built_in\">time</span>=<span class=\"number\">2</span><span class=\"built_in\">days</span> </span><br></pre></td></tr></table></figure>\n\n<p>删除两个礼拜前的日志：</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">journalctl <span class=\"attribute\">--vacuum-time</span>=2weeks </span><br></pre></td></tr></table></figure>\n\n<p>或者删除超出文件大小的日志：</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">journalctl <span class=\"attribute\">--vacuum-size</span>=20M </span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">journalctl <span class=\"comment\">--disk-usage</span></span><br><span class=\"line\"><span class=\"comment\"># OR</span></span><br><span class=\"line\">du -sh /<span class=\"built_in\">run</span>/<span class=\"built_in\">log</span>/journal</span><br><span class=\"line\">journalctl <span class=\"comment\">--verify</span></span><br><span class=\"line\">ls -l /<span class=\"built_in\">run</span>/<span class=\"built_in\">log</span>/journal/*</span><br><span class=\"line\">systemctl status systemd-journald </span><br></pre></td></tr></table></figure>\n\n<p>修改配置文件：</p>\n<p><code>sudo vi /etc/systemd/journald.conf</code></p>\n<p>修改其中的两项：</p>\n<figure class=\"highlight abnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">SystemMaxUse</span><span class=\"operator\">=</span><span class=\"number\">100</span>M</span><br><span class=\"line\"><span class=\"attribute\">RuntimeMaxUse</span><span class=\"operator\">=</span><span class=\"number\">100</span>M </span><br></pre></td></tr></table></figure>\n\n<p>SystemMaxUse 设置 <code>/var/log/journal</code> RuntimeMaxUse 设置 <code>/run/log/journal</code></p>\n<p>然后使设置生效：</p>\n<figure class=\"highlight ebnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">sudo systemctl daemon-reload</span> </span><br></pre></td></tr></table></figure>\n\n<p>问题</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>Warning: Journal has been rotated since unit was started. Log output is incomplete or unavailable.</p></blockquote>\n<p>原因是：</p>\n<p><code>the disk usage of the log files for journald</code> journal 日志空间达到了上限</p>\n","text":"Linux 下 journal 日志清理Linux 在运行的过程中会产生很多日志文件，一般存放在 /var/log 目录下，而其中 journal 目录中存放的...","permalink":"/post/LINUX/Linux 下 journal 日志清理","photos":[],"count_time":{"symbolsCount":"1.2k","symbolsTime":"1 mins."},"categories":[{"name":"journal","slug":"journal","count":1,"path":"api/categories/journal.json"},{"name":"LINUX","slug":"journal/LINUX","count":1,"path":"api/categories/journal/LINUX.json"}],"tags":[{"name":"log","slug":"log","count":4,"path":"api/tags/log.json"},{"name":"var","slug":"var","count":1,"path":"api/tags/var.json"},{"name":"journald","slug":"journald","count":1,"path":"api/tags/journald.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Linux-%E4%B8%8B-journal-%E6%97%A5%E5%BF%97%E6%B8%85%E7%90%86\"><span class=\"toc-text\">Linux 下 journal 日志清理</span></a></li></ol>","author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"SQL解析器组件","uid":"d877b3555659291721a2f384975f0ecc","slug":"JAVA/SQL解析器组件","date":"2023-03-22T14:25:04.000Z","updated":"2025-09-30T03:26:15.631Z","comments":true,"path":"api/articles/JAVA/SQL解析器组件.json","keywords":"XuGuangSheng","cover":"/covers/sql.jpg","text":"SQL解析器组件 hzero-starter-sqlparser是基于druid的sql解析器移植而来，未来会逐渐完善功能、增强api。 sql语句首先需要由p...","permalink":"/post/JAVA/SQL解析器组件","photos":[],"count_time":{"symbolsCount":"8.6k","symbolsTime":"8 mins."},"categories":[{"name":"sql","slug":"sql","count":1,"path":"api/categories/sql.json"},{"name":"JAVA","slug":"sql/JAVA","count":1,"path":"api/categories/sql/JAVA.json"}],"tags":[{"name":"ast","slug":"ast","count":1,"path":"api/tags/ast.json"},{"name":"AST","slug":"AST","count":1,"path":"api/tags/AST.json"},{"name":"starter","slug":"starter","count":1,"path":"api/tags/starter.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Keepalived 原理介绍和配置实践","uid":"443c51534ca02ffae6ff782b6bfd2503","slug":"MIDDLEWARE/Keepalived 原理介绍和配置实践","date":"2023-02-22T10:59:21.000Z","updated":"2025-09-30T03:26:48.252Z","comments":true,"path":"api/articles/MIDDLEWARE/Keepalived 原理介绍和配置实践.json","keywords":"XuGuangSheng","cover":"/covers/keepalived.jpg","text":"Keepalived 原理介绍和配置实践参考文章Keepalived - http://www.keepalived.org/doc/The Keepalive...","permalink":"/post/MIDDLEWARE/Keepalived 原理介绍和配置实践","photos":[],"count_time":{"symbolsCount":"30k","symbolsTime":"27 mins."},"categories":[{"name":"Keepalived","slug":"Keepalived","count":1,"path":"api/categories/Keepalived.json"},{"name":"MIDDLEWARE","slug":"Keepalived/MIDDLEWARE","count":1,"path":"api/categories/Keepalived/MIDDLEWARE.json"}],"tags":[{"name":"https","slug":"https","count":44,"path":"api/tags/https.json"},{"name":"keepalived","slug":"keepalived","count":1,"path":"api/tags/keepalived.json"},{"name":"LVS","slug":"LVS","count":1,"path":"api/tags/LVS.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}