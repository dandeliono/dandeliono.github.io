{"title":"记一次spring boot 功能模块化 freemarker只能识别一个resources目录下前端展示模板问题","uid":"b118a4f61bac8ee2550c64d69640d355","slug":"JAVA/记一次spring boot 功能模块化 freemarker只能识别一个resources目录下前端展示模板问题","date":"2022-10-07T14:04:24.000Z","updated":"2025-09-30T03:26:29.807Z","comments":true,"path":"api/articles/JAVA/记一次spring boot 功能模块化 freemarker只能识别一个resources目录下前端展示模板问题.json","keywords":"XuGuangSheng","cover":"/covers/spring-boot-freemarkerresources.jpg","content":"<h1 id=\"记一次spring-boot-功能模块化-freemarker只能识别一个resources目录下前端展示模板问题-一枚码农的个人空间-OSCHINA-中文开源技术交流社区\"><a href=\"#记一次spring-boot-功能模块化-freemarker只能识别一个resources目录下前端展示模板问题-一枚码农的个人空间-OSCHINA-中文开源技术交流社区\" class=\"headerlink\" title=\"记一次spring boot 功能模块化 freemarker只能识别一个resources目录下前端展示模板问题 - 一枚码农的个人空间 - OSCHINA - 中文开源技术交流社区\"></a>记一次spring boot 功能模块化 freemarker只能识别一个resources目录下前端展示模板问题 - 一枚码农的个人空间 - OSCHINA - 中文开源技术交流社区</h1><p>今天开发个人开源框架，完善了系统模块后，集成工作流功能模块，在新的 resources 下面新建 freemarker 前端页面 (ftl 页面)，然后正常开发到展示流程表的时候，后台报错情景重新：<strong>Could not resolve view with name ‘&#x2F;actList’ in servlet with name ‘dispatcherServlet’</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/dandeliono/img/main/resource/b844629541b50194618dc83b81c5a39b.png\"></p>\n<p>当时我就想是不是映射地址出错了，检查多次后发现也没错，怎么 spring mvc 就映射不到呢，而且是相同的的地址路径 (模块不一样)，和其他模块 resources 一致的路径，然后我系统模块是完全没问题的，我感觉应该是 freemarker 配置的问题，然后各种尝试，各种检查，各种查阅资料，发现，的确是 freemarker 的问题，我少配置了一项 freemarker 配置：<strong>FreeMarkerConfigurationFactory</strong>类下的属性：<strong>preferFileSystemAccess，&lt;— 对就是它，</strong>我们来看源码发现默认是<strong>true</strong></p>\n<pre><code>public class FreeMarkerConfigurationFactory &#123;\n\n    protected final Log logger = LogFactory.getLog(getClass());\n\n    private Resource configLocation;\n\n    private Properties freemarkerSettings;\n\n    private Map&lt;String, Object&gt; freemarkerVariables;\n\n    private String defaultEncoding;\n\n    private final List&lt;TemplateLoader&gt; templateLoaders = new ArrayList&lt;TemplateLoader&gt;();\n\n    private List&lt;TemplateLoader&gt; preTemplateLoaders;\n\n    private List&lt;TemplateLoader&gt; postTemplateLoaders;\n\n    private String[] templateLoaderPaths;\n\n    private ResourceLoader resourceLoader = new DefaultResourceLoader();\n\n    private boolean preferFileSystemAccess = true;\n</code></pre>\n<p>那么他是干嘛用的呢，我们看官方介绍是介绍：</p>\n<p>Set whether to prefer file system access for template loading. File system access enables hot detection of template changes.<br>If this is enabled, FreeMarkerConfigurationFactory will try to resolve the specified “templateLoaderPath” as file system resource (which will work for expanded class path resources and ServletContext resources too).</p>\n<p>Default is “true”. Turn this off to always load via SpringTemplateLoader (i.e. as stream, without hot detection of template changes), which might be necessary if some of your templates reside in an expanded classes directory while others reside in jar files.</p>\n<p>我们随便翻一下：第一句的意思是是否以更喜欢方式来访问模板</p>\n<p>如果启用就以 templateLoaderPath 设置的路径来加载，默认为 true，设置为 false 的话就以 SpringTemplateLoader 方式访问，那么就是流的方式访问，这可能是必要的, 如果你的一些模板驻留在一个扩展的类而其他人驻留在 jar 文件的目录。</p>\n<p>意思就是 如果你的文件在 jar 包文件目录下，就有必要设置为 false，我们是多模块的，最终只运行一个模块，其他模块都是以 jar 包来加载的，我们要加载 jar 包里面的文件目录，必须要把这个属性设置为 false 才行，debug 源码看看，先上配置文件：</p>\n<pre><code>@Bean\n  public FreeMarkerConfigurer freemarkerConfig() throws IOException, TemplateException &#123;\n    FreeMarkerConfigurationFactory factory = new FreeMarkerConfigurationFactory();\n    factory.setTemplateLoaderPath(&quot;classpath:/ftl/&quot;);\n    factory.setDefaultEncoding(&quot;UTF-8&quot;);\n    factory.setPreferFileSystemAccess(true);\n    FreeMarkerConfigurer result = new FreeMarkerConfigurer();\n    freemarker.template.Configuration configuration = factory.createConfiguration();\n    configuration.setClassicCompatible(true);\n    result.setConfiguration(configuration);\n    Properties settings = new Properties();\n    settings.put(&quot;template_update_delay&quot;, &quot;0&quot;);\n    settings.put(&quot;default_encoding&quot;, &quot;UTF-8&quot;);\n    settings.put(&quot;number_format&quot;, &quot;0.######&quot;);\n    settings.put(&quot;classic_compatible&quot;, true);\n    settings.put(&quot;template_exception_handler&quot;, &quot;ignore&quot;);\n    result.setFreemarkerSettings(settings);\n    return result;\n  &#125;\n</code></pre>\n<p><strong>FreeMarkerConfigurationFactory</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/dandeliono/img/main/resource/9e1b9e5492f8578c73b73f1d32be4aae.png\"></p>\n<p>返回<img src=\"https://raw.githubusercontent.com/dandeliono/img/main/resource/35ba589a64f54758ed741d2e18295410.png\"></p>\n<p>最终返回：</p>\n<p><img src=\"https://raw.githubusercontent.com/dandeliono/img/main/resource/46114958218282c08a30a46d4bf11d45.png\"></p>\n<p>看到没，是单个模块的绝对路径 ftl 文件夹。</p>\n<p>看图我们可以明确知道为 true 的话，加载的是设置的 setTemplateLoaderPath 的路径 也就是我其中一个模块下的 ftl 路径，所以<strong>其他模块下 ftl 路径是加载不出来的</strong>，也就<strong>是 spring mvc 映射不到的原因。</strong> </p>\n<p>我们试试 将<strong>isPreferFileSystemAccess</strong>设置为<strong>false：</strong> </p>\n<p><img src=\"https://raw.githubusercontent.com/dandeliono/img/main/resource/eb25683283f8ffba09f0843cb1069935.png\"></p>\n<p>最终我们跟到这里：</p>\n<p><img src=\"https://raw.githubusercontent.com/dandeliono/img/main/resource/00135842b2b0f2cea6bf54841a7ac93f.png\"></p>\n<p>发现路径是 &#x2F; ftl &#x2F; 而不是之前的绝对路径，然后 set 进 spring 对 freemarker 的配置对象中。</p>\n<p>好的，我们通过分析源码我们可以知道，多模块下，我们<strong>设置为 false，spring 才能以相对路径来访问我们的模板文件夹</strong>，问题解决。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#spring boot 配置项</span><br><span class=\"line\">spring.freemarker.prefer-file-system-access=<span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n","text":"记一次spring boot 功能模块化 freemarker只能识别一个resources目录下前端展示模板问题 - 一枚码农的个人空间 - OSCHINA ...","permalink":"/post/JAVA/记一次spring boot 功能模块化 freemarker只能识别一个resources目录下前端展示模板问题","photos":[],"count_time":{"symbolsCount":"3.7k","symbolsTime":"3 mins."},"categories":[{"name":"resource","slug":"resource","count":1,"path":"api/categories/resource.json"},{"name":"JAVA","slug":"resource/JAVA","count":1,"path":"api/categories/resource/JAVA.json"}],"tags":[{"name":"https","slug":"https","count":44,"path":"api/tags/https.json"},{"name":"raw","slug":"raw","count":5,"path":"api/tags/raw.json"},{"name":"freemarker","slug":"freemarker","count":1,"path":"api/tags/freemarker.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E8%AE%B0%E4%B8%80%E6%AC%A1spring-boot-%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97%E5%8C%96-freemarker%E5%8F%AA%E8%83%BD%E8%AF%86%E5%88%AB%E4%B8%80%E4%B8%AAresources%E7%9B%AE%E5%BD%95%E4%B8%8B%E5%89%8D%E7%AB%AF%E5%B1%95%E7%A4%BA%E6%A8%A1%E6%9D%BF%E9%97%AE%E9%A2%98-%E4%B8%80%E6%9E%9A%E7%A0%81%E5%86%9C%E7%9A%84%E4%B8%AA%E4%BA%BA%E7%A9%BA%E9%97%B4-OSCHINA-%E4%B8%AD%E6%96%87%E5%BC%80%E6%BA%90%E6%8A%80%E6%9C%AF%E4%BA%A4%E6%B5%81%E7%A4%BE%E5%8C%BA\"><span class=\"toc-text\">记一次spring boot 功能模块化 freemarker只能识别一个resources目录下前端展示模板问题 - 一枚码农的个人空间 - OSCHINA - 中文开源技术交流社区</span></a></li></ol>","author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"掌握MyBatis插件原理轻松写出自己的PageHelper分页插件","uid":"39567589e8d82514e8e405343a06adf8","slug":"JAVA/掌握MyBatis插件原理轻松写出自己的PageHelper分页插件","date":"2022-10-07T14:04:24.000Z","updated":"2025-09-30T03:26:26.405Z","comments":true,"path":"api/articles/JAVA/掌握MyBatis插件原理轻松写出自己的PageHelper分页插件.json","keywords":"XuGuangSheng","cover":"/covers/mybatispagehelper.jpg","text":"掌握MyBatis插件原理轻松写出自己的PageHelper分页插件-阿里云开发者社区在 MyBatis 中插件式通过拦截器来实现的，那么既然是通过拦截器来实现...","permalink":"/post/JAVA/掌握MyBatis插件原理轻松写出自己的PageHelper分页插件","photos":[],"count_time":{"symbolsCount":"5.7k","symbolsTime":"5 mins."},"categories":[{"name":"https","slug":"https","count":12,"path":"api/categories/https.json"},{"name":"JAVA","slug":"https/JAVA","count":5,"path":"api/categories/https/JAVA.json"}],"tags":[{"name":"com","slug":"com","count":26,"path":"api/tags/com.json"},{"name":"raw","slug":"raw","count":5,"path":"api/tags/raw.json"},{"name":"githubusercontent","slug":"githubusercontent","count":3,"path":"api/tags/githubusercontent.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"zookeeper curator处理会话过期session expired","uid":"84d510f335cb1c9f3ff98caa4f69cfc2","slug":"MIDDLEWARE/zookeeper curator处理会话过期session expired","date":"2022-10-07T14:04:24.000Z","updated":"2025-09-30T03:26:53.936Z","comments":true,"path":"api/articles/MIDDLEWARE/zookeeper curator处理会话过期session expired.json","keywords":"XuGuangSheng","cover":"/covers/zookeeper-curatorsession-expired.jpg","text":"zookeeper curator处理会话过期session expired - 扎心了老铁 - 博客园本文介绍在使用 curator 框架的时候如何 hand...","permalink":"/post/MIDDLEWARE/zookeeper curator处理会话过期session expired","photos":[],"count_time":{"symbolsCount":"4.2k","symbolsTime":"4 mins."},"categories":[{"name":"session","slug":"session","count":2,"path":"api/categories/session.json"},{"name":"MIDDLEWARE","slug":"session/MIDDLEWARE","count":1,"path":"api/categories/session/MIDDLEWARE.json"}],"tags":[{"name":"zookeeper","slug":"zookeeper","count":2,"path":"api/tags/zookeeper.json"},{"name":"client","slug":"client","count":1,"path":"api/tags/client.json"},{"name":"expired","slug":"expired","count":1,"path":"api/tags/expired.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}