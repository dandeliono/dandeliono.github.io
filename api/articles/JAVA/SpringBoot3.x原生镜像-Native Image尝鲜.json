{"title":"SpringBoot3.x原生镜像-Native Image尝鲜","uid":"6f7565fb2acf3311af859a2ea4b76698","slug":"JAVA/SpringBoot3.x原生镜像-Native Image尝鲜","date":"2023-04-26T16:52:21.000Z","updated":"2025-12-05T01:46:36.967Z","comments":true,"path":"api/articles/JAVA/SpringBoot3.x原生镜像-Native Image尝鲜.json","keywords":"XuGuangSheng","cover":"/covers/springboot3-x-native-image.jpg","content":"<h1 id=\"SpringBoot3-x原生镜像-Native-Image尝鲜\"><a href=\"#SpringBoot3-x原生镜像-Native-Image尝鲜\" class=\"headerlink\" title=\"SpringBoot3.x原生镜像-Native Image尝鲜\"></a>SpringBoot3.x原生镜像-Native Image尝鲜</h1><h2 id=\"前提\"><a href=\"#前提\" class=\"headerlink\" title=\"前提#\"></a>前提<a href=\"#%E5%89%8D%E6%8F%90\">#</a></h2><p><code>Spring</code>团队致力于为<code>Spring</code>应用程序提供原生映像支持已经有一段时间了。在<code>SpringBoo2.x</code>的<code>Spring Native</code>实验项目中酝酿了3年多之后，随着<code>Spring Framework 6</code>和<code>Spring Boot 3</code>的发布，对应的项目就是<code>Spring Native</code>，原生镜像支持将会发布<code>GA</code>版本（换言之就是，<code>Native Image</code>相关支持会在<code>Spring Boot 3</code>的<code>GA</code>版本中一起发布）。</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>前面这一段简介摘抄自参考资料中的《Native Support in Spring Boot 3.0.0-M5》</p></blockquote>\n<p>笔者在写这篇文章（<code>2022-10-28</code>）前后<code>SpringBoot</code>尚未发布<code>3.x GA</code>，版本<code>3.0.0-M5+</code>算是<code>GA</code>前相对稳定的版本，这里选用当前<code>3.x</code>的最新非<code>GA</code>版本<code>3.0.0-RC1</code>进行调研。</p>\n<p><a href=\"https://cdn.vlts.cn/202210/spring-boot-native-image-1.jpg\"><img src=\"https://cdn.vlts.cn/202210/spring-boot-native-image-1.jpg\">\n</a></p>\n<h2 id=\"什么是Native-Image\"><a href=\"#什么是Native-Image\" class=\"headerlink\" title=\"什么是Native Image#\"></a>什么是Native Image<a href=\"#%E4%BB%80%E4%B9%88%E6%98%AFnative-image\">#</a></h2><p><code>Native Image</code>，这里直译为原生镜像或者本地镜像，是一种提前将（<code>Java</code>）代码编译为二进制文件（原生可执行文件，<code>native executable</code>）的技术。原生可执行文件只包含运行时所需要的代码，即应用程序类、标准库类、语言运行时和来自<code>JDK</code>的静态链接的原生代码（也就是**这样的二进制文件可以直接运行，不需要额外安装<code>JDK</code>**）。由原生镜像生成的可执行文件有几个重要的优点：</p>\n<ul>\n<li>使用<code>Java</code>虚拟机所需资源的一小部分，因此运行成本更低</li>\n<li>启动时间大幅度下降，以毫秒为单位</li>\n<li>不需要进行预热即可提供最佳性能</li>\n<li>可以打包到轻量级容器映像中以便快速有效地部署</li>\n<li>减少了攻击面（这个和网络安全相关）</li>\n</ul>\n<p><code>Spring Boot 3</code>中<strong>使用<code>GraalVM</code>方案提供<code>Native Image</code>支持</strong>。</p>\n<h2 id=\"安装GraalVM\"><a href=\"#安装GraalVM\" class=\"headerlink\" title=\"安装GraalVM#\"></a>安装GraalVM<a href=\"#%E5%AE%89%E8%A3%85graalvm\">#</a></h2><p>在<a href=\"https://www.graalvm.org/downloads\">https://www.graalvm.org/downloads - Download GraalVM</a>页面中下载对应操作系统的<code>GraalVM</code>：</p>\n<p><a href=\"https://cdn.vlts.cn/202210/spring-boot-native-image-2.png\"><img src=\"https://cdn.vlts.cn/202210/spring-boot-native-image-2.png\">\n</a></p>\n<p>笔者开发环境使用的操作系统是<code>Windows10</code>，下载和选用下图中的安装包：</p>\n<p><a href=\"https://cdn.vlts.cn/202210/spring-boot-native-image-3.png\"><img src=\"https://cdn.vlts.cn/202210/spring-boot-native-image-3.png\">\n</a></p>\n<p>解压完成后配置一下<code>JAVA_HOME</code>、<code>GRAALVM_HOME</code>并且把<code>GRAALVM_HOME\\bin</code>添加到<code>PATH</code>中。完成后可以执行一下<code>java -version</code>进行验证：</p>\n<p><a href=\"https://cdn.vlts.cn/202210/spring-boot-native-image-4.png\"><img src=\"https://cdn.vlts.cn/202210/spring-boot-native-image-4.png\">\n</a></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>如果已经安装了其他版本的JDK，先暂时全局替换为GraalVM，也就是JAVA_HOME、GRAALVM_HOME同时配置为GraalVM的解压目录，因为目前看来这样做才能正常打包原生镜像</p></blockquote>\n<p>确定<code>GraalVM</code>版本无误，到此安装完成。另外，需要配置好了<code>Maven</code>，建议重新安装一个<code>3.6.x+</code>版本的<code>Maven</code>并且把<code>MAVEN_HOME\\bin</code>添加到<code>PATH</code>中。</p>\n<h2 id=\"编写应用程序\"><a href=\"#编写应用程序\" class=\"headerlink\" title=\"编写应用程序#\"></a>编写应用程序<a href=\"#%E7%BC%96%E5%86%99%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F\">#</a></h2><p>新建一个命名为<code>spring-boot-native-image</code>的<code>Maven</code>项目或者模块，选用刚才下载好的<code>GraalVM</code>：</p>\n<p><a href=\"https://cdn.vlts.cn/202210/spring-boot-native-image-5.png\"><img src=\"https://cdn.vlts.cn/202210/spring-boot-native-image-5.png\">\n</a></p>\n<p>项目的<code>POM</code>文件引入下面几组依赖：</p>\n<ul>\n<li><code>spring</code>的快照<code>repository</code>，因为需要下载<code>RC1</code>版本依赖，暂时不能从中央仓库拉取</li>\n<li><code>spring-boot-starter-parent</code>，定义版本为<code>RC1</code></li>\n<li><code>native-maven-plugin</code>插件，用于原生镜像打包</li>\n<li><code>spring-boot-starter-web</code>，用于构建一个简单的<code>web</code>项目</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.0.0-RC1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-snapshots<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/snapshot<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-milestones<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/milestone<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">pluginRepositories</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">pluginRepository</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-snapshots<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/snapshot<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">pluginRepository</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">pluginRepository</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-milestones<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/milestone<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">pluginRepository</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">pluginRepositories</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.graalvm.buildtools<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>native-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.16<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">extensions</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">extensions</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>build-native<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>compile-no-fork<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">phase</span>&gt;</span>package<span class=\"tag\">&lt;/<span class=\"name\">phase</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>test-native<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">phase</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">phase</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">mainClass</span>&gt;</span>cn.vlts.NativeApplication<span class=\"tag\">&lt;/<span class=\"name\">mainClass</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">imageName</span>&gt;</span>native-app<span class=\"tag\">&lt;/<span class=\"name\">imageName</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">buildArgs</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">buildArg</span>&gt;</span>--verbose<span class=\"tag\">&lt;/<span class=\"name\">buildArg</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">buildArgs</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span> </span><br></pre></td></tr></table></figure>\n\n<p>最终的<code>POM</code>文件看起来如下：</p>\n<p><a href=\"https://cdn.vlts.cn/202210/spring-boot-native-image-6.png\"><img src=\"https://cdn.vlts.cn/202210/spring-boot-native-image-6.png\">\n</a></p>\n<p>项目中只有一个启动类<code>cn.vlts.NativeApplication</code>，编写了<code>main</code>方法和一个用于集成测试的控制器方法：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NativeApplication</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"built_in\">void</span> <span class=\"title function_\">main</span>(<span class=\"params\"><span class=\"built_in\">String</span>[] args</span>) &#123;</span><br><span class=\"line\">        <span class=\"title class_\">SpringApplication</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">NativeApplication</span>.<span class=\"property\">class</span>, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping</span>(path = <span class=\"string\">&quot;/hello&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title class_\">ResponseEntity</span>&lt;<span class=\"title class_\">String</span>&gt; <span class=\"title function_\">hello</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title class_\">ResponseEntity</span>.<span class=\"title function_\">ok</span>(<span class=\"string\">&quot;world&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"打包和调试\"><a href=\"#打包和调试\" class=\"headerlink\" title=\"打包和调试#\"></a>打包和调试<a href=\"#%E6%89%93%E5%8C%85%E5%92%8C%E8%B0%83%E8%AF%95\">#</a></h2><p>完成项目配置和代码编写后，执行下面的<code>Maven</code>命令进行打包：</p>\n<figure class=\"highlight ada\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn <span class=\"keyword\">package</span> <span class=\"title\">-Pnative </span></span><br></pre></td></tr></table></figure>\n\n<p>打包过程可能会遇到下面的问题：</p>\n<ul>\n<li>最有可能的问题：<code>Default native-compiler executable &#39;cl.exe&#39; not found via environment variable PATH</code></li>\n</ul>\n<p>解决方案在<code>Stackoverflow</code>对应的问题回答中找到：</p>\n<p><a href=\"https://cdn.vlts.cn/202210/spring-boot-native-image-7.png\"><img src=\"https://cdn.vlts.cn/202210/spring-boot-native-image-7.png\">\n</a></p>\n<p>其实就是在<code>Window</code>操作系统开发环境下基于<code>GraalVM</code>构建原生镜像依赖<code>Microsoft Visual C++ (MSVC)</code>，建议安装<code>MSVC 2017 15.5.5+</code>，可以安装<code>Visual Studio (2019)</code>并且安装对应的<code>MSVC</code>。</p>\n<p>因为很早之前笔者在调试<code>Rust</code>时候已经安装过<code>Visual Studio 2019</code>用于其<code>debug</code>工具链，这里无须进行安装。在安装<code>Visual Studio</code>勾选<code>MSVC vXXX</code>的组件进行安装即可，然后需要把对应的<code>MSVC</code>工具的<code>bin</code>目录添加到<code>PATH</code>中（这个目录一般是<code>VS_HOME\\VC\\Tools\\MSVC\\版本号\\bin\\Hostx64\\x64</code>）：</p>\n<p><a href=\"https://cdn.vlts.cn/202210/spring-boot-native-image-8.png\"><img src=\"https://cdn.vlts.cn/202210/spring-boot-native-image-8.png\">\n</a></p>\n<ul>\n<li>其次可能遇到的问题：打包过程出现<code>stdio.h</code>库文件报错或者找不到主类<code>Main entry point class &#39;app.jar&#39; not found x.y.Application</code></li>\n</ul>\n<p>其实还是因为<code>MSVC</code>的问题，在<code>GraalVM</code>文档中有提示如下：</p>\n<p><a href=\"https://cdn.vlts.cn/202210/spring-boot-native-image-9.png\"><img src=\"https://cdn.vlts.cn/202210/spring-boot-native-image-9.png\">\n</a></p>\n<p>简单来说就是<strong>必须在<code>Visual Studio</code>自带的命令行工具<code>x64 Native Tools Command Prompt</code>中执行<code>native image</code>相关命令</strong>，这个命令行工具初始化如下：</p>\n<p><a href=\"https://cdn.vlts.cn/202210/spring-boot-native-image-10.png\"><img src=\"https://cdn.vlts.cn/202210/spring-boot-native-image-10.png\">\n</a></p>\n<p>在<code>x64 Native Tools Command Prompt</code>中先进入目标项目根目录，然后执行<code>mvn -Pnative package</code>：</p>\n<p><a href=\"https://cdn.vlts.cn/202210/spring-boot-native-image-11.png\"><img src=\"https://cdn.vlts.cn/202210/spring-boot-native-image-11.png\">\n</a></p>\n<p>最终看到<code>BUILD SUCCESS</code>字眼，项目的<code>target</code>目录下可以看到一个<code>.exe</code>和一个<code>.jar</code>文件，而<code>.exe</code>文件就是前面一直提到的<strong>可执行的二进制文件</strong>：</p>\n<p><a href=\"https://cdn.vlts.cn/202210/spring-boot-native-image-14.png\"><img src=\"https://cdn.vlts.cn/202210/spring-boot-native-image-14.png\">\n</a></p>\n<p>直接运行它：</p>\n<p><a href=\"https://cdn.vlts.cn/202210/spring-boot-native-image-12.png\"><img src=\"https://cdn.vlts.cn/202210/spring-boot-native-image-12.png\">\n</a></p>\n<p>可以看到这个文件运行完全不依赖外部<code>Java</code>虚拟机，并且启动速度极快（<code>600</code>毫秒左右），可以用<code>POSTMAN</code>等工具测试程序接口：</p>\n<p><a href=\"https://cdn.vlts.cn/202210/spring-boot-native-image-13.png\"><img src=\"https://cdn.vlts.cn/202210/spring-boot-native-image-13.png\">\n</a></p>\n<p>到此可以验证程序功能正常。</p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结#\"></a>小结<a href=\"#%E5%B0%8F%E7%BB%93\">#</a></h2><p><code>SpringBoot3.x</code>原生镜像正式发布后会是<code>SpringBoot</code>在云原生领域的一个巨大进步，让我们拭目以待。但是就目前来看，常用的<code>Windows</code>开发环境下想要尝试<code>native image</code>技术需要解决比较多的问题，<code>Linux</code>和<code>Unix</code>平台下尚未验证，希望后面的版本迭代能够降低使用难度并且支持一个命令多平台打包的功能。</p>\n<p>参考资料：</p>\n<ul>\n<li><a href=\"https://spring.io/blog/2022/09/26/native-support-in-spring-boot-3-0-0-m5\">Native Support in Spring Boot 3.0.0-M5</a></li>\n<li><a href=\"https://www.graalvm.org/java/quickstart\">GraalVM - Quick Start Guide</a></li>\n</ul>\n","text":"SpringBoot3.x原生镜像-Native Image尝鲜前提#Spring团队致力于为Spring应用程序提供原生映像支持已经有一段时间了。在Sprin...","permalink":"/post/JAVA/SpringBoot3.x原生镜像-Native Image尝鲜","photos":[],"count_time":{"symbolsCount":"5.7k","symbolsTime":"5 mins."},"categories":[{"name":"native","slug":"native","count":1,"path":"api/categories/native.json"},{"name":"JAVA","slug":"native/JAVA","count":1,"path":"api/categories/native/JAVA.json"}],"tags":[{"name":"https","slug":"https","count":44,"path":"api/tags/https.json"},{"name":"spring","slug":"spring","count":4,"path":"api/tags/spring.json"},{"name":"boot","slug":"boot","count":1,"path":"api/tags/boot.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#SpringBoot3-x%E5%8E%9F%E7%94%9F%E9%95%9C%E5%83%8F-Native-Image%E5%B0%9D%E9%B2%9C\"><span class=\"toc-text\">SpringBoot3.x原生镜像-Native Image尝鲜</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%89%8D%E6%8F%90\"><span class=\"toc-text\">前提</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BB%80%E4%B9%88%E6%98%AFNative-Image\"><span class=\"toc-text\">什么是Native Image</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85GraalVM\"><span class=\"toc-text\">安装GraalVM</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%BC%96%E5%86%99%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F\"><span class=\"toc-text\">编写应用程序</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%89%93%E5%8C%85%E5%92%8C%E8%B0%83%E8%AF%95\"><span class=\"toc-text\">打包和调试</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%B0%8F%E7%BB%93\"><span class=\"toc-text\">小结</span></a></li></ol></li></ol>","author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Flux数据脚本语言","uid":"8ebea8637205b0f6626f1c002b32980b","slug":"MIDDLEWARE/Flux数据脚本语言","date":"2023-04-26T20:04:53.000Z","updated":"2025-12-05T01:47:26.547Z","comments":true,"path":"api/articles/MIDDLEWARE/Flux数据脚本语言.json","keywords":"XuGuangSheng","cover":"/covers/flux.jpg","text":"Flux数据脚本语言官方文档：Flux data scripting language | InfluxDB Enterprise 1.9 Documentat...","permalink":"/post/MIDDLEWARE/Flux数据脚本语言","photos":[],"count_time":{"symbolsCount":"110k","symbolsTime":"1:40"},"categories":[{"name":"Flux","slug":"Flux","count":1,"path":"api/categories/Flux.json"},{"name":"MIDDLEWARE","slug":"Flux/MIDDLEWARE","count":1,"path":"api/categories/Flux/MIDDLEWARE.json"}],"tags":[{"name":"使用","slug":"使用","count":5,"path":"api/tags/使用.json"},{"name":"time","slug":"time","count":1,"path":"api/tags/time.json"},{"name":"value","slug":"value","count":1,"path":"api/tags/value.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"如何在Ubuntu 20.04设置DNS","uid":"09d76d6e509e739e24346e7394d4915f","slug":"LINUX/如何在Ubuntu 20.04设置DNS","date":"2023-04-25T15:22:25.000Z","updated":"2025-12-05T01:47:15.539Z","comments":true,"path":"api/articles/LINUX/如何在Ubuntu 20.04设置DNS.json","keywords":"XuGuangSheng","cover":"/covers/ubuntu-20-04dns.jpg","text":"如何在Ubuntu 20.04设置DNSDNS域名系统是网络基础架构的核心部分，提供了一种将域名转换为IP地址的方法。 您可以将DNS视为互联网的电话簿。注意这...","permalink":"/post/LINUX/如何在Ubuntu 20.04设置DNS","photos":[],"count_time":{"symbolsCount":"4.2k","symbolsTime":"4 mins."},"categories":[{"name":"DNS","slug":"DNS","count":1,"path":"api/categories/DNS.json"},{"name":"LINUX","slug":"DNS/LINUX","count":1,"path":"api/categories/DNS/LINUX.json"}],"tags":[{"name":"https","slug":"https","count":44,"path":"api/tags/https.json"},{"name":"com","slug":"com","count":26,"path":"api/tags/com.json"},{"name":"myfreax","slug":"myfreax","count":1,"path":"api/tags/myfreax.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}