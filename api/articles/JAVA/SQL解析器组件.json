{"title":"SQL解析器组件","uid":"d877b3555659291721a2f384975f0ecc","slug":"JAVA/SQL解析器组件","date":"2023-03-22T14:25:04.000Z","updated":"2025-12-05T01:46:28.282Z","comments":true,"path":"api/articles/JAVA/SQL解析器组件.json","keywords":"XuGuangSheng","cover":"/covers/sql.jpg","content":"<h1 id=\"SQL解析器组件\"><a href=\"#SQL解析器组件\" class=\"headerlink\" title=\"SQL解析器组件\"></a>SQL解析器组件</h1><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>hzero-starter-sqlparser是基于druid的sql解析器移植而来，未来会逐渐完善功能、增强api。</p></blockquote>\n<p>sql语句首先需要由parser转化为AST，并通过visitor获取sql语句的类型、from条件、where条件、groupby等信息。</p>\n<h2 id=\"AST-abstract-syntax-tree\"><a href=\"#AST-abstract-syntax-tree\" class=\"headerlink\" title=\"AST(abstract syntax tree)\"></a>AST(abstract syntax tree)</h2><p>中文含义为抽象语法树，以下是一个简单sql语句的ast图。</p>\n<p>SELECT a FROM table_a WHERE table_a.a &#x3D; ‘a’;</p>\n<p><img src=\"https://open.hand-china.com/img/docs/development-component/starter/%E7%AE%80%E5%8D%95sql%E7%9A%84AST%E5%9B%BE.png\"></p>\n<p>简单理解，就是把字符串形式的sql语句结构化，变成具有层次的树形结构，便于sql语句的分析、改造。如果需要对现有的sql语句改造，则可以直接更新ast上的节点信息。</p>\n<p>ast节点主要包括SQLObject、SQLExpr、SQLStatement三种抽象类型。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">interface SQLObject &#123;&#125;</span><br><span class=\"line\">interface SQLExpr extends SQLObject &#123;&#125;</span><br><span class=\"line\">interface SQLStatement extends SQLObject &#123;&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"SQLExpr\"><a href=\"#SQLExpr\" class=\"headerlink\" title=\"SQLExpr\"></a>SQLExpr</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">public interface SQLName extends SQLExpr &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">class SQLIdentifierExpr implements SQLExpr, SQLName &#123;</span><br><span class=\"line\">    String name;</span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">class SQLPropertyExpr implements SQLExpr, SQLName &#123;</span><br><span class=\"line\">    SQLExpr owner;</span><br><span class=\"line\">    String name;</span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">class SQLBinaryOpExpr implements SQLExpr &#123;</span><br><span class=\"line\">    SQLExpr left;</span><br><span class=\"line\">    SQLExpr right;</span><br><span class=\"line\">    SQLBinaryOperator operator;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">class SQLVariantRefExpr extends SQLExprImpl &#123; </span><br><span class=\"line\">    String name;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">public class SQLIntegerExpr extends SQLNumericLiteralExpr implements SQLValuableExpr &#123; </span><br><span class=\"line\">    Number number;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public Object getValue() &#123;</span><br><span class=\"line\">        return this.number;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">public class SQLCharExpr extends SQLTextLiteralExpr implements SQLValuableExpr&#123;</span><br><span class=\"line\">    String text;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"SQLStatement\"><a href=\"#SQLStatement\" class=\"headerlink\" title=\"SQLStatement\"></a>SQLStatement</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class SQLSelectStatement implements SQLStatement &#123;</span><br><span class=\"line\">    SQLSelect select;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">class SQLUpdateStatement implements SQLStatement &#123;</span><br><span class=\"line\">    SQLExprTableSource tableSource;</span><br><span class=\"line\">     List&lt;SQLUpdateSetItem&gt; items;</span><br><span class=\"line\">     SQLExpr where;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">class SQLDeleteStatement implements SQLStatement &#123;</span><br><span class=\"line\">    SQLTableSource tableSource; </span><br><span class=\"line\">    SQLExpr where;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">class SQLInsertStatement implements SQLStatement &#123;</span><br><span class=\"line\">    SQLExprTableSource tableSource;</span><br><span class=\"line\">    List&lt;SQLExpr&gt; columns;</span><br><span class=\"line\">    SQLSelect query;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"SQLTableSource\"><a href=\"#SQLTableSource\" class=\"headerlink\" title=\"SQLTableSource\"></a>SQLTableSource</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class SQLTableSourceImpl extends SQLObjectImpl implements SQLTableSource &#123; </span><br><span class=\"line\">    String alias;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">class SQLExprTableSource extends SQLTableSourceImpl &#123;</span><br><span class=\"line\">    SQLExpr expr;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">class SQLJoinTableSource extends SQLTableSourceImpl &#123;</span><br><span class=\"line\">    SQLTableSource left;</span><br><span class=\"line\">    SQLTableSource right;</span><br><span class=\"line\">    JoinType joinType; </span><br><span class=\"line\">    SQLExpr condition;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">SQLSubqueryTableSource extends SQLTableSourceImpl &#123;</span><br><span class=\"line\">    SQLSelect select;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">class SQLWithSubqueryClause &#123;</span><br><span class=\"line\">    static class Entry extends SQLTableSourceImpl &#123; </span><br><span class=\"line\">         SQLSelect subQuery;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"SQLSelectStatement\"><a href=\"#SQLSelectStatement\" class=\"headerlink\" title=\"SQLSelectStatement\"></a>SQLSelectStatement</h3><p>SQLSelectStatement包含一个SQLSelect，SQLSelect包含一个SQLSelectQuery，都是组成的关系。SQLSelectQuery有主要的两个派生类，分别是SQLSelectQueryBlock和SQLUnionQuery。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class SQLSelect extends SQLObjectImpl &#123; </span><br><span class=\"line\">    SQLWithSubqueryClause withSubQuery;</span><br><span class=\"line\">    SQLSelectQuery query;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">interface SQLSelectQuery extends SQLObject &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">class SQLSelectQueryBlock implements SQLSelectQuery &#123;</span><br><span class=\"line\">    List&lt;SQLSelectItem&gt; selectList;</span><br><span class=\"line\">    SQLTableSource from;</span><br><span class=\"line\">    SQLExprTableSource into;</span><br><span class=\"line\">    SQLExpr where;</span><br><span class=\"line\">    SQLSelectGroupByClause groupBy;</span><br><span class=\"line\">    SQLOrderBy orderBy;</span><br><span class=\"line\">    SQLLimit limit;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">class SQLUnionQuery implements SQLSelectQuery &#123;</span><br><span class=\"line\">    SQLSelectQuery left;</span><br><span class=\"line\">    SQLSelectQuery right;</span><br><span class=\"line\">    SQLUnionOperator operator; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"SQLCreateTableStatement\"><a href=\"#SQLCreateTableStatement\" class=\"headerlink\" title=\"SQLCreateTableStatement\"></a>SQLCreateTableStatement</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class SQLCreateTableStatement extends SQLStatementImpl implements SQLDDLStatement, SQLCreateStatement &#123;</span><br><span class=\"line\">    SQLExprTableSource tableSource;</span><br><span class=\"line\">    List&lt;SQLTableElement&gt; tableElementList;</span><br><span class=\"line\">    Select select;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    public SQLColumnDefinition findColumn(String columName) &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    public SQLTableElement findIndex(String columnName) &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    public boolean isReferenced(String tableName) &#123;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用案例\"><a href=\"#使用案例\" class=\"headerlink\" title=\"使用案例\"></a>使用案例</h2><h3 id=\"ast全语法示例代码\"><a href=\"#ast全语法示例代码\" class=\"headerlink\" title=\"ast全语法示例代码\"></a>ast全语法示例代码</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Test &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static void main(String[] args) &#123;</span><br><span class=\"line\">        String sql = &quot;select a,b from (select * from table_a) temp where temp.a = &#x27;a&#x27;;&quot;;</span><br><span class=\"line\">        </span><br><span class=\"line\">        List&lt;SQLStatement&gt; statements = SQLUtils.parseStatements(sql, JdbcConstants.MYSQL);</span><br><span class=\"line\">        </span><br><span class=\"line\">        SQLStatement statement = statements.get(0);</span><br><span class=\"line\">        </span><br><span class=\"line\">        SQLSelectStatement sqlSelectStatement = (SQLSelectStatement) statement;</span><br><span class=\"line\">        SQLSelectQuery sqlSelectQuery = sqlSelectStatement.getSelect().getQuery();</span><br><span class=\"line\">        </span><br><span class=\"line\">        if (sqlSelectQuery instanceof SQLSelectQueryBlock) &#123;</span><br><span class=\"line\">            SQLSelectQueryBlock sqlSelectQueryBlock = (SQLSelectQueryBlock) sqlSelectQuery;</span><br><span class=\"line\">            </span><br><span class=\"line\">            List&lt;SQLSelectItem&gt; selectItems         = sqlSelectQueryBlock.getSelectList();</span><br><span class=\"line\">            selectItems.forEach(x -&gt; &#123;</span><br><span class=\"line\">                </span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            </span><br><span class=\"line\">            SQLTableSource table = sqlSelectQueryBlock.getFrom();</span><br><span class=\"line\">            </span><br><span class=\"line\">            if (table instanceof SQLExprTableSource) &#123;</span><br><span class=\"line\">                </span><br><span class=\"line\">                </span><br><span class=\"line\">            &#125; else if (table instanceof SQLJoinTableSource) &#123;</span><br><span class=\"line\">                </span><br><span class=\"line\">                </span><br><span class=\"line\">            &#125; else if (table instanceof SQLSubqueryTableSource) &#123;</span><br><span class=\"line\">                </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            SQLExpr where = sqlSelectQueryBlock.getWhere();</span><br><span class=\"line\">            </span><br><span class=\"line\">            if (where instanceof SQLBinaryOpExpr) &#123;</span><br><span class=\"line\">                SQLBinaryOpExpr   sqlBinaryOpExpr = (SQLBinaryOpExpr) where;</span><br><span class=\"line\">                SQLExpr           left            = sqlBinaryOpExpr.getLeft();</span><br><span class=\"line\">                SQLBinaryOperator operator        = sqlBinaryOpExpr.getOperator();</span><br><span class=\"line\">                SQLExpr           right           = sqlBinaryOpExpr.getRight();</span><br><span class=\"line\">                </span><br><span class=\"line\">                </span><br><span class=\"line\">            &#125; else if (where instanceof SQLInSubQueryExpr) &#123;</span><br><span class=\"line\">                SQLInSubQueryExpr sqlInSubQueryExpr = (SQLInSubQueryExpr) where;</span><br><span class=\"line\">                </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            SQLSelectGroupByClause groupBy = sqlSelectQueryBlock.getGroupBy();</span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\">            SQLOrderBy orderBy = sqlSelectQueryBlock.getOrderBy();</span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\">            SQLLimit limit = sqlSelectQueryBlock.getLimit();</span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\">        &#125; else if (sqlSelectQuery instanceof SQLUnionQuery) &#123;</span><br><span class=\"line\">            </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        </span><br><span class=\"line\">        SQLInsertStatement sqlInsertStatement = (SQLInsertStatement) statement;</span><br><span class=\"line\">        </span><br><span class=\"line\">        SQLWithSubqueryClause with = sqlInsertStatement.getWith();</span><br><span class=\"line\">        </span><br><span class=\"line\">        SQLTableSource insertTable = sqlInsertStatement.getTableSource();</span><br><span class=\"line\">        </span><br><span class=\"line\">        List&lt;SQLExpr&gt; insertColumns = sqlInsertStatement.getColumns();</span><br><span class=\"line\">        </span><br><span class=\"line\">        SQLSelect insertSelect = sqlInsertStatement.getQuery();</span><br><span class=\"line\">        </span><br><span class=\"line\">        List&lt;SQLInsertStatement.ValuesClause&gt; values = sqlInsertStatement.getValuesList();</span><br><span class=\"line\"></span><br><span class=\"line\">        </span><br><span class=\"line\">        SQLUpdateStatement sqlUpdateStatement = (SQLUpdateStatement) statement;</span><br><span class=\"line\">        </span><br><span class=\"line\">        List&lt;SQLUpdateSetItem&gt; updateSetItems = sqlUpdateStatement.getItems();</span><br><span class=\"line\">        </span><br><span class=\"line\">        SQLTableSource updateTable = sqlUpdateStatement.getFrom();</span><br><span class=\"line\">        </span><br><span class=\"line\">        SQLExpr updateWhere = sqlUpdateStatement.getWhere();</span><br><span class=\"line\"></span><br><span class=\"line\">        </span><br><span class=\"line\">        SQLDeleteStatement sqlDeleteStatement = (SQLDeleteStatement) statement;</span><br><span class=\"line\">        </span><br><span class=\"line\">        SQLTableSource deleteTable = sqlDeleteStatement.getFrom();</span><br><span class=\"line\">        </span><br><span class=\"line\">        SQLExpr deleteWhere = sqlDeleteStatement.getWhere();</span><br><span class=\"line\"></span><br><span class=\"line\">        </span><br><span class=\"line\">        SQLCreateTableStatement sqlCreateTableStatement = (SQLCreateTableStatement) statement;</span><br><span class=\"line\">        </span><br><span class=\"line\">        sqlCreateTableStatement.findIndex(&quot;a&quot;);</span><br><span class=\"line\">        </span><br><span class=\"line\">        sqlCreateTableStatement.findColumn(&quot;a&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用visitor获取sql信息\"><a href=\"#使用visitor获取sql信息\" class=\"headerlink\" title=\"使用visitor获取sql信息\"></a>使用visitor获取sql信息</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Test &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static void main(String[] args) &#123;</span><br><span class=\"line\">        String sql = &quot;select a,b from (select * from table_a) temp where temp.a = &#x27;a&#x27;;&quot;;</span><br><span class=\"line\">        </span><br><span class=\"line\">        List&lt;SQLStatement&gt; statements = SQLUtils.parseStatements(sql, JdbcConstants.MYSQL);</span><br><span class=\"line\">        </span><br><span class=\"line\">        SQLStatement statement = statements.get(0);</span><br><span class=\"line\">        </span><br><span class=\"line\">        MySqlSchemaStatVisitor visitor = new MySqlSchemaStatVisitor();</span><br><span class=\"line\">        </span><br><span class=\"line\">        statement.accept(visitor);</span><br><span class=\"line\"></span><br><span class=\"line\">        </span><br><span class=\"line\">        System.out.println(&quot;数据库类型\\t\\t&quot; + visitor.getDbType());</span><br><span class=\"line\">        </span><br><span class=\"line\">        System.out.println(&quot;查询的字段\\t\\t&quot; + visitor.getColumns());</span><br><span class=\"line\">        </span><br><span class=\"line\">        System.out.println(&quot;表名\\t\\t\\t&quot; + visitor.getTables().keySet());</span><br><span class=\"line\">        </span><br><span class=\"line\">        System.out.println(&quot;条件\\t\\t\\t&quot; + visitor.getConditions());</span><br><span class=\"line\">        </span><br><span class=\"line\">        System.out.println(&quot;group by\\t\\t&quot; + visitor.getGroupByColumns());</span><br><span class=\"line\">        </span><br><span class=\"line\">        System.out.println(&quot;order by\\t\\t&quot; + visitor.getOrderByColumns());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n","text":"SQL解析器组件 hzero-starter-sqlparser是基于druid的sql解析器移植而来，未来会逐渐完善功能、增强api。 sql语句首先需要由p...","permalink":"/post/JAVA/SQL解析器组件","photos":[],"count_time":{"symbolsCount":"8.6k","symbolsTime":"8 mins."},"categories":[{"name":"sql","slug":"sql","count":1,"path":"api/categories/sql.json"},{"name":"JAVA","slug":"sql/JAVA","count":1,"path":"api/categories/sql/JAVA.json"}],"tags":[{"name":"ast","slug":"ast","count":1,"path":"api/tags/ast.json"},{"name":"AST","slug":"AST","count":1,"path":"api/tags/AST.json"},{"name":"starter","slug":"starter","count":1,"path":"api/tags/starter.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#SQL%E8%A7%A3%E6%9E%90%E5%99%A8%E7%BB%84%E4%BB%B6\"><span class=\"toc-text\">SQL解析器组件</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#AST-abstract-syntax-tree\"><span class=\"toc-text\">AST(abstract syntax tree)</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#SQLExpr\"><span class=\"toc-text\">SQLExpr</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#SQLStatement\"><span class=\"toc-text\">SQLStatement</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#SQLTableSource\"><span class=\"toc-text\">SQLTableSource</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#SQLSelectStatement\"><span class=\"toc-text\">SQLSelectStatement</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#SQLCreateTableStatement\"><span class=\"toc-text\">SQLCreateTableStatement</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B\"><span class=\"toc-text\">使用案例</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#ast%E5%85%A8%E8%AF%AD%E6%B3%95%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">ast全语法示例代码</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8visitor%E8%8E%B7%E5%8F%96sql%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">使用visitor获取sql信息</span></a></li></ol></li></ol></li></ol>","author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Spring RestTemplate使用指南","uid":"a48fe76127f611e471ecf4672c3ea452","slug":"JAVA/Spring RestTemplate使用指南","date":"2023-04-07T14:56:26.000Z","updated":"2025-12-05T01:46:33.042Z","comments":true,"path":"api/articles/JAVA/Spring RestTemplate使用指南.json","keywords":"XuGuangSheng","cover":"/covers/spring-resttemplate.jpg","text":"Spring RestTemplate使用指南〇、介绍 spring-web框架下的一个http客户端，提供了一种通用的接口。 HTTP请求方式可以选择： 原生...","permalink":"/post/JAVA/Spring RestTemplate使用指南","photos":[],"count_time":{"symbolsCount":"9.9k","symbolsTime":"9 mins."},"categories":[{"name":"HttpMessageConverter","slug":"HttpMessageConverter","count":1,"path":"api/categories/HttpMessageConverter.json"},{"name":"JAVA","slug":"HttpMessageConverter/JAVA","count":1,"path":"api/categories/HttpMessageConverter/JAVA.json"}],"tags":[{"name":"HTTP","slug":"HTTP","count":2,"path":"api/tags/HTTP.json"},{"name":"ClientHttpRequestFactory","slug":"ClientHttpRequestFactory","count":1,"path":"api/tags/ClientHttpRequestFactory.json"},{"name":"MappingJackson","slug":"MappingJackson","count":1,"path":"api/tags/MappingJackson.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Linux 下 journal 日志清理","uid":"1d828a50cab789d76b35014d3e9c8893","slug":"LINUX/Linux 下 journal 日志清理","date":"2023-02-22T11:56:19.000Z","updated":"2025-12-05T01:47:00.010Z","comments":true,"path":"api/articles/LINUX/Linux 下 journal 日志清理.json","keywords":"XuGuangSheng","cover":"/covers/linux-journal.jpg","text":"Linux 下 journal 日志清理Linux 在运行的过程中会产生很多日志文件，一般存放在 /var/log 目录下，而其中 journal 目录中存放的...","permalink":"/post/LINUX/Linux 下 journal 日志清理","photos":[],"count_time":{"symbolsCount":"1.2k","symbolsTime":"1 mins."},"categories":[{"name":"journal","slug":"journal","count":1,"path":"api/categories/journal.json"},{"name":"LINUX","slug":"journal/LINUX","count":1,"path":"api/categories/journal/LINUX.json"}],"tags":[{"name":"log","slug":"log","count":4,"path":"api/tags/log.json"},{"name":"var","slug":"var","count":1,"path":"api/tags/var.json"},{"name":"journald","slug":"journald","count":1,"path":"api/tags/journald.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}