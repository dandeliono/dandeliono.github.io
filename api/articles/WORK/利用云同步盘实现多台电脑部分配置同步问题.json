{"title":"利用云同步盘实现多台电脑部分配置同步问题","uid":"8d8408765c8cd5cad402c3f0cebc116d","slug":"WORK/利用云同步盘实现多台电脑部分配置同步问题","date":"2022-03-24T23:43:47.000Z","updated":"2025-12-05T01:48:08.178Z","comments":true,"path":"api/articles/WORK/利用云同步盘实现多台电脑部分配置同步问题.json","keywords":"XuGuangSheng","cover":"/covers/a1df9b7b1dfb.jpg","content":"<h1 id=\"利用云同步盘实现多台电脑部分配置同步问题\"><a href=\"#利用云同步盘实现多台电脑部分配置同步问题\" class=\"headerlink\" title=\"利用云同步盘实现多台电脑部分配置同步问题\"></a>利用云同步盘实现多台电脑部分配置同步问题</h1><p>我们经常会在公司，个人甚至更多环境不同的电脑进行切换，当然，也存在重装系统、换电脑等问题。而在每次更换之后，都会进行一次环境配置。或者在某台电脑上修改了部分配置而其他电脑又需要再次配置一次。</p>\n<p>尤其是类似于 ssh 密钥等配置，每次不光是重新生成一份就行了，还需要去各平台新增，及其麻烦。</p>\n<p>当然，使用云盘拷贝备份的方式可行，但是每次修改都需要再次备份，会存在遗忘的情况，有办法让配置自动同步么？</p>\n<p>答案是有的！</p>\n<p>我们可以利用云同步盘（如 OneDrive）让配置文件自动同步，同时利用文件链接如 window 的 mklink 创建文件链接。实际文件存放在云同步盘中，而系统配置中的文件使用链接的方式。</p>\n<p>这样不管是修改哪个文件，源文件都会被修改然后被云同步盘自动同步。</p>\n<p>例 ssh 下的 config 文件创建文件链接（windows）：</p>\n<figure class=\"highlight dos\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">mklink config <span class=\"variable\">%USERPROFILE%</span>/.ssh/config</span><br></pre></td></tr></table></figure>\n\n<p>这样我们不管是修改云盘中的文件还是 C 盘下的文件，源文件都会被修改同步。</p>\n<p>但是这样我们需要在每台电脑上都进行一次文件链接创建。</p>\n<p>所以这里提供一个脚本直接进行链接创建，想来看看目录结构以及说明：</p>\n<p>每个目录对应系统中某个文件夹，具体对应的文件夹根目录为当前文件中的 .localpath 的内容。映射时会把当前目录下的所有文件分别链接到 .localpath 所指定的目录并且一一对应。</p>\n<pre><code>-- settings/\n  -- userprofile/ # C 盘目录下 user/用户名 下面配置\n    -- .ssh/\n      -- config\n      -- id_rsa\n      -- id_rsa.pub\n    -- .gitconfig\n    -- .npmrc\n    -- .yarnrc\n    -- .localpath # 文件内容：%USERPROFILE%，即系统盘中的&quot;user/用户名&quot;目录\n  -- others/ # 其他配置\n    -- .localpath # others 文件所对应的系统目录位置\n  -- init.bat # 创建软链\n复制代码\n</code></pre>\n<p>这样在执行 settings&#x2F;init.bat 就会吧 userprofile 文件夹下面的所有文件分别映射到 %USERPROFILE% 对应的文件下，即创建 .npmrc、.yarnrc、.gitconfig、以及 .ssh 下的所有配置进行映射同步。</p>\n<p>这样无论 修改 哪里的文件，同步盘中的内容都会跟着更新并同步。同时另外一台有做链接映射的电脑打开的时候同步盘自动更新后，系统配置文件也就自动更新了！</p>\n<p>而在重装系统、新增电脑的机器上把同步盘装上同步下来后执行 init.bat 就 OK 了。</p>\n<p>当然，如果是跨平台的操作系统，可以提供更多的配置，如 init.sh 等。</p>\n<p>这里附以下 init.bat 文件：</p>\n<figure class=\"highlight dos\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"built_in\">echo</span> off</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">setlocal</span> enabledelayedexpansion</span><br><span class=\"line\"> @<span class=\"built_in\">echo</span> off </span><br><span class=\"line\">:: 同步设置的根路径</span><br><span class=\"line\"><span class=\"built_in\">set</span> SyncSettingsPath=<span class=\"variable\">%OneDrive%</span>\\settings</span><br><span class=\"line\">:: .localpath的文件名</span><br><span class=\"line\"><span class=\"built_in\">set</span> LocalPathName=.localpath</span><br><span class=\"line\"></span><br><span class=\"line\">:: 遍历当前目录所有文件夹</span><br><span class=\"line\"><span class=\"keyword\">for</span> /f <span class=\"variable\">%%n</span> <span class=\"keyword\">in</span> (&#x27;<span class=\"built_in\">dir</span> <span class=\"variable\">%SyncSettingsPath%</span> /b /a:d&#x27;) <span class=\"keyword\">do</span> (</span><br><span class=\"line\">  <span class=\"keyword\">if</span> <span class=\"keyword\">exist</span> <span class=\"variable\">%SyncSettingsPath%</span>\\<span class=\"variable\">%%n</span>\\<span class=\"variable\">%LocalPathName%</span> (</span><br><span class=\"line\">    :: 读取.localpath</span><br><span class=\"line\">    <span class=\"keyword\">for</span> /f <span class=\"variable\">%%i</span> <span class=\"keyword\">in</span> (&#x27;<span class=\"built_in\">type</span> <span class=\"variable\">%SyncSettingsPath%</span>\\<span class=\"variable\">%%n</span>\\<span class=\"variable\">%LocalPathName%</span>&#x27;) <span class=\"keyword\">do</span> <span class=\"built_in\">set</span> LocalPathContent=<span class=\"variable\">%%i</span></span><br><span class=\"line\"></span><br><span class=\"line\">    :: 转换.localpath内容中的变量</span><br><span class=\"line\">    <span class=\"keyword\">for</span> /f <span class=\"variable\">%%i</span> <span class=\"keyword\">in</span> (&#x27;<span class=\"built_in\">echo</span> <span class=\"variable\">!LocalPathContent!</span>&#x27;) <span class=\"keyword\">do</span> (</span><br><span class=\"line\">      :: 递归遍历当前文件夹下非.localpath的文件</span><br><span class=\"line\">      <span class=\"keyword\">for</span> /f <span class=\"variable\">%%f</span> <span class=\"keyword\">in</span> (&#x27;<span class=\"built_in\">dir</span> <span class=\"variable\">%SyncSettingsPath%</span>\\<span class=\"variable\">%%n</span> /s /b /a:-d ^| <span class=\"built_in\">find</span> /v &quot;<span class=\"variable\">%LocalPathName%</span>&quot;&#x27;) <span class=\"keyword\">do</span> (</span><br><span class=\"line\">        <span class=\"built_in\">set</span> CurrentSyncFilePath=<span class=\"variable\">%%f</span></span><br><span class=\"line\">        <span class=\"built_in\">set</span> CurrentLocalFilePath=<span class=\"variable\">!CurrentSyncFilePath:%SyncSettingsPath%\\%%n=%%i!</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">exist</span> <span class=\"variable\">!CurrentLocalFilePath!</span> <span class=\"built_in\">del</span> <span class=\"variable\">!CurrentLocalFilePath!</span></span><br><span class=\"line\">        mklink <span class=\"variable\">!CurrentLocalFilePath!</span> <span class=\"variable\">!CurrentSyncFilePath!</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    )</span><br><span class=\"line\">  )</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n","text":"利用云同步盘实现多台电脑部分配置同步问题我们经常会在公司，个人甚至更多环境不同的电脑进行切换，当然，也存在重装系统、换电脑等问题。而在每次更换之后，都会进行一次...","permalink":"/post/WORK/利用云同步盘实现多台电脑部分配置同步问题","photos":[],"count_time":{"symbolsCount":"2.2k","symbolsTime":"2 mins."},"categories":[{"name":"init","slug":"init","count":1,"path":"api/categories/init.json"},{"name":"WORK","slug":"init/WORK","count":1,"path":"api/categories/init/WORK.json"}],"tags":[{"name":"当然","slug":"当然","count":1,"path":"api/tags/当然.json"},{"name":"ssh","slug":"ssh","count":1,"path":"api/tags/ssh.json"},{"name":"bat","slug":"bat","count":1,"path":"api/tags/bat.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8%E4%BA%91%E5%90%8C%E6%AD%A5%E7%9B%98%E5%AE%9E%E7%8E%B0%E5%A4%9A%E5%8F%B0%E7%94%B5%E8%84%91%E9%83%A8%E5%88%86%E9%85%8D%E7%BD%AE%E5%90%8C%E6%AD%A5%E9%97%AE%E9%A2%98\"><span class=\"toc-text\">利用云同步盘实现多台电脑部分配置同步问题</span></a></li></ol>","author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Homeassistant - 使用小爱音箱控制 Hass 设备","uid":"0ba37cbc11858729ececbe4090fe5335","slug":"OTHER/Homeassistant - 使用小爱音箱控制 Hass 设备","date":"2022-03-28T20:30:27.000Z","updated":"2025-12-05T01:48:03.046Z","comments":true,"path":"api/articles/OTHER/Homeassistant - 使用小爱音箱控制 Hass 设备.json","keywords":"XuGuangSheng","cover":"/covers/homeassistant-hass.jpg","text":"Homeassistant - 使用小爱音箱控制 Hass 设备使用小爱音箱 + 小爱开放平台技能开发 + NodeRed 控制 Homeassistant 的...","permalink":"/post/OTHER/Homeassistant - 使用小爱音箱控制 Hass 设备","photos":[],"count_time":{"symbolsCount":987,"symbolsTime":"1 mins."},"categories":[{"name":"https","slug":"https","count":12,"path":"api/categories/https.json"},{"name":"OTHER","slug":"https/OTHER","count":2,"path":"api/categories/https/OTHER.json"}],"tags":[{"name":"com","slug":"com","count":26,"path":"api/tags/com.json"},{"name":"NodeRed","slug":"NodeRed","count":1,"path":"api/tags/NodeRed.json"},{"name":"state","slug":"state","count":1,"path":"api/tags/state.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Nginx 服务器应用详解","uid":"83fcc4ed8f1c6107bdf89c34a8b59a09","slug":"MIDDLEWARE/Nginx 服务器应用详解","date":"2022-02-26T11:17:14.000Z","updated":"2025-12-05T01:47:34.836Z","comments":true,"path":"api/articles/MIDDLEWARE/Nginx 服务器应用详解.json","keywords":"XuGuangSheng","cover":"/covers/nginx.jpg","text":"Nginx 服务器应用详解一、前言Nginx作为一个异步框架的 Web服务器，也可以用作反向代理，负载平衡器 和 HTTP缓存，下面本篇文章就来介绍一下Ngin...","permalink":"/post/MIDDLEWARE/Nginx 服务器应用详解","photos":[],"count_time":{"symbolsCount":"6.4k","symbolsTime":"6 mins."},"categories":[{"name":"nginx","slug":"nginx","count":3,"path":"api/categories/nginx.json"},{"name":"MIDDLEWARE","slug":"nginx/MIDDLEWARE","count":2,"path":"api/categories/nginx/MIDDLEWARE.json"}],"tags":[{"name":"https","slug":"https","count":44,"path":"api/tags/https.json"},{"name":"SSL","slug":"SSL","count":1,"path":"api/tags/SSL.json"},{"name":"复制代码","slug":"复制代码","count":1,"path":"api/tags/复制代码.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}