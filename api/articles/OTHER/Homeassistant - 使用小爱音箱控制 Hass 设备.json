{"title":"Homeassistant - 使用小爱音箱控制 Hass 设备","uid":"0ba37cbc11858729ececbe4090fe5335","slug":"OTHER/Homeassistant - 使用小爱音箱控制 Hass 设备","date":"2022-03-28T20:30:27.000Z","updated":"2025-09-30T03:27:01.150Z","comments":true,"path":"api/articles/OTHER/Homeassistant - 使用小爱音箱控制 Hass 设备.json","keywords":"XuGuangSheng","cover":"/covers/homeassistant-hass.jpg","content":"<h1 id=\"Homeassistant-使用小爱音箱控制-Hass-设备\"><a href=\"#Homeassistant-使用小爱音箱控制-Hass-设备\" class=\"headerlink\" title=\"Homeassistant - 使用小爱音箱控制 Hass 设备\"></a>Homeassistant - 使用小爱音箱控制 Hass 设备</h1><p>使用小爱音箱 + 小爱开放平台技能开发 + NodeRed 控制 Homeassistant 的设备。</p>\n<p>很多内容基于网上大神的基础总结而来。</p>\n<h2 id=\"小爱开放平台\"><a href=\"#小爱开放平台\" class=\"headerlink\" title=\"小爱开放平台\"></a><a href=\"#%E5%B0%8F%E7%88%B1%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0\" title=\"小爱开放平台\"></a>小爱开放平台</h2><p>配置参考视频：<a href=\"https://www.bilibili.com/video/BV1Xy4y1i79c\">https://www.bilibili.com/video/BV1Xy4y1i79c</a></p>\n<p>注意的是，</p>\n<ol>\n<li>修改 <code>调用名称</code>, <code>语料</code>后可能会有些延迟才生效？最好把一个一个的下一步都点一遍。</li>\n<li>需要提供 https 的调用网址，参考：<a href=\"https://www.bilibili.com/video/BV19h411f7dp\">https://www.bilibili.com/video/BV19h411f7dp</a> 以及之前的文章有说配置 https （实际就是起一个 https 服务，可以非 443 端口，可以 Nginx 代理，也可以程序自己启动 https 服务。用端口映射过去就能访问）。</li>\n<li>官网网页提供调试。调试实际就是通过<code>调用名称</code>激活 &#x2F; 启动自定义命令，然后自定义命令只要命中<code>语料</code>，就会调用自己提供的 https 接口服务。大佬提供的 <code>conversation</code> 只是帮我们启动了一个服务并内置了一些命令解析。</li>\n</ol>\n<h2 id=\"小爱自定义技能接入到-NodeRed\"><a href=\"#小爱自定义技能接入到-NodeRed\" class=\"headerlink\" title=\"小爱自定义技能接入到 NodeRed\"></a><a href=\"#%E5%B0%8F%E7%88%B1%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8A%80%E8%83%BD%E6%8E%A5%E5%85%A5%E5%88%B0-NodeRed\" title=\"小爱自定义技能接入到 NodeRed\"></a>小爱自定义技能接入到 NodeRed</h2><ul>\n<li>NodeRed - 节点管理 - 安装 <code>node-red-contrib-home-assistant-websocket</code> - <code>node-red-contrib-xiaoai-tts</code> （已安装直接下一步）</li>\n<li>添加节点 - events:state 监听状态改变 - 设置属性：Entity ID 为 <code>conversation.voice</code> （语音助手的实体 ID）</li>\n<li>添加节点 - switch - 通过 <code>payload</code> 自定义后续事件</li>\n<li>为了防止这种情况： state change 后，我们的智能设备实际没有变化，我们又发请求 change 同样的 state，此时 state 没有变化就监听不到。</li>\n<li>所以在监听状态改变后，增加节点 - 延迟 2s - call API - 设置属性：HTTP POST，path:&#x2F;api&#x2F;states&#x2F;conversation.voice, data: {“state”:”waiting”}</li>\n<li>也就是每次状态改变后我们把状态重置一下，下一次下命令就肯定会 state change 了。</li>\n</ul>\n<p><a href=\"https://raw.githubusercontent.com/dandeliono/img/main/resource/e8729a7fca1f09de1630d9612f31f322.jpeg\"><img src=\"https://raw.githubusercontent.com/dandeliono/img/main/resource/e8729a7fca1f09de1630d9612f31f322.jpeg\">\n</a></p>\n<p><a href=\"https://raw.githubusercontent.com/dandeliono/img/main/resource/e8729a7fca1f09de1630d9612f31f322.jpeg\">NodeRed</a></p>\n","text":"Homeassistant - 使用小爱音箱控制 Hass 设备使用小爱音箱 + 小爱开放平台技能开发 + NodeRed 控制 Homeassistant 的...","permalink":"/post/OTHER/Homeassistant - 使用小爱音箱控制 Hass 设备","photos":[],"count_time":{"symbolsCount":987,"symbolsTime":"1 mins."},"categories":[{"name":"https","slug":"https","count":12,"path":"api/categories/https.json"},{"name":"OTHER","slug":"https/OTHER","count":2,"path":"api/categories/https/OTHER.json"}],"tags":[{"name":"com","slug":"com","count":26,"path":"api/tags/com.json"},{"name":"NodeRed","slug":"NodeRed","count":1,"path":"api/tags/NodeRed.json"},{"name":"state","slug":"state","count":1,"path":"api/tags/state.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Homeassistant-%E4%BD%BF%E7%94%A8%E5%B0%8F%E7%88%B1%E9%9F%B3%E7%AE%B1%E6%8E%A7%E5%88%B6-Hass-%E8%AE%BE%E5%A4%87\"><span class=\"toc-text\">Homeassistant - 使用小爱音箱控制 Hass 设备</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%B0%8F%E7%88%B1%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0\"><span class=\"toc-text\">小爱开放平台</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%B0%8F%E7%88%B1%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8A%80%E8%83%BD%E6%8E%A5%E5%85%A5%E5%88%B0-NodeRed\"><span class=\"toc-text\">小爱自定义技能接入到 NodeRed</span></a></li></ol></li></ol>","author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Advanced tuning finding and fixing slow Elasticsearch queries","uid":"19b24bca918ce369e190f8fc79735fce","slug":"MIDDLEWARE/Advanced tuning finding and fixing slow Elasticsearch queries","date":"2022-03-29T10:28:38.000Z","updated":"2025-09-30T03:26:44.406Z","comments":true,"path":"api/articles/MIDDLEWARE/Advanced tuning finding and fixing slow Elasticsearch queries.json","keywords":"XuGuangSheng","cover":"/covers/advanced-tuning-finding-and-fixing-slow-elasticsearch-queries.jpg","text":"Advanced tuning: finding and fixing slow Elasticsearch queriesElasticsearch 是一个非...","permalink":"/post/MIDDLEWARE/Advanced tuning finding and fixing slow Elasticsearch queries","photos":[],"count_time":{"symbolsCount":"9.2k","symbolsTime":"8 mins."},"categories":[{"name":"elastic","slug":"elastic","count":1,"path":"api/categories/elastic.json"},{"name":"MIDDLEWARE","slug":"elastic/MIDDLEWARE","count":1,"path":"api/categories/elastic/MIDDLEWARE.json"}],"tags":[{"name":"https","slug":"https","count":44,"path":"api/tags/https.json"},{"name":"www","slug":"www","count":8,"path":"api/tags/www.json"},{"name":"elasticsearch","slug":"elasticsearch","count":1,"path":"api/tags/elasticsearch.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"利用云同步盘实现多台电脑部分配置同步问题","uid":"8d8408765c8cd5cad402c3f0cebc116d","slug":"WORK/利用云同步盘实现多台电脑部分配置同步问题","date":"2022-03-24T23:43:47.000Z","updated":"2025-09-30T03:27:02.871Z","comments":true,"path":"api/articles/WORK/利用云同步盘实现多台电脑部分配置同步问题.json","keywords":"XuGuangSheng","cover":"/covers/a1df9b7b1dfb.jpg","text":"利用云同步盘实现多台电脑部分配置同步问题我们经常会在公司，个人甚至更多环境不同的电脑进行切换，当然，也存在重装系统、换电脑等问题。而在每次更换之后，都会进行一次...","permalink":"/post/WORK/利用云同步盘实现多台电脑部分配置同步问题","photos":[],"count_time":{"symbolsCount":"2.2k","symbolsTime":"2 mins."},"categories":[{"name":"init","slug":"init","count":1,"path":"api/categories/init.json"},{"name":"WORK","slug":"init/WORK","count":1,"path":"api/categories/init/WORK.json"}],"tags":[{"name":"当然","slug":"当然","count":1,"path":"api/tags/当然.json"},{"name":"ssh","slug":"ssh","count":1,"path":"api/tags/ssh.json"},{"name":"bat","slug":"bat","count":1,"path":"api/tags/bat.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}