{"title":"在 Kubernetes 集群上安装 KubeVirt","uid":"5a79b62bd0cc256cbc198b2e3cc42ba4","slug":"OCI/在 Kubernetes 集群上安装 KubeVirt","date":"2024-10-25T15:18:17.000Z","updated":"2025-09-30T03:27:00.439Z","comments":true,"path":"api/articles/OCI/在 Kubernetes 集群上安装 KubeVirt.json","keywords":"XuGuangSheng","cover":"/covers/kubernetes-kubevirt.jpg","content":"<h1 id=\"在-Kubernetes-集群上安装-KubeVirt\"><a href=\"#在-Kubernetes-集群上安装-KubeVirt\" class=\"headerlink\" title=\"在 Kubernetes 集群上安装 KubeVirt\"></a>在 Kubernetes 集群上安装 KubeVirt</h1><p>安装 KubeVirt 并创建虚拟机可以按照以下步骤进行。</p>\n<h3 id=\"安装-KubeVirt\"><a href=\"#安装-KubeVirt\" class=\"headerlink\" title=\"安装 KubeVirt\"></a>安装 KubeVirt</h3><ol>\n<li><strong>安装 KubeVirt Operator</strong></li>\n</ol>\n<p>首先，需要安装 KubeVirt Operator，它会管理 KubeVirt 的部署和生命周期。运行以下命令来安装 KubeVirt Operator：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export VERSION=$(curl -s https://api.github.com/repos/kubevirt/kubevirt/releases/latest | jq -r .tag_name)</span><br><span class=\"line\">kubectl create -f https://github.com/kubevirt/kubevirt/releases/download/$&#123;VERSION&#125;/kubevirt-operator.yaml</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>安装 KubeVirt CustomResource (CR)</strong></li>\n</ol>\n<p>接下来，创建一个 KubeVirt 自定义资源 (CR)，来启动 KubeVirt：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create -f https://github.com/kubevirt/kubevirt/releases/download/$&#123;VERSION&#125;/kubevirt-cr.yaml</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><strong>验证安装</strong></li>\n</ol>\n<p>使用以下命令验证 KubeVirt 是否已正确安装并正在运行：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get pods -n kubevirt</span><br><span class=\"line\">kubectl get kubevirt.kubevirt.io/kubevirt -n kubevirt</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>你应该能看到 KubeVirt 的相关组件已经运行。</p>\n<h3 id=\"安装-virtctl\"><a href=\"#安装-virtctl\" class=\"headerlink\" title=\"安装 virtctl\"></a>安装 virtctl</h3><p><code>virtctl</code> 是一个用于管理 KubeVirt 虚拟机的命令行工具。你可以从 GitHub 上下载适合你系统的二进制文件：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export VIRTCTL_VERSION=$(curl -s https://api.github.com/repos/kubevirt/kubevirt/releases/latest | jq -r .tag_name)</span><br><span class=\"line\">curl -L -o virtctl https://github.com/kubevirt/kubevirt/releases/download/$&#123;VIRTCTL_VERSION&#125;/virtctl-$&#123;VIRTCTL_VERSION&#125;-linux-amd64</span><br><span class=\"line\">chmod +x virtctl</span><br><span class=\"line\">sudo mv virtctl /usr/local/bin/</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建虚拟机的示例\"><a href=\"#创建虚拟机的示例\" class=\"headerlink\" title=\"创建虚拟机的示例\"></a>创建虚拟机的示例</h3><ol>\n<li><strong>定义一个虚拟机</strong></li>\n</ol>\n<p>创建一个虚拟机 YAML 文件，例如 <code>vm.yaml</code>，内容如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apiVersion: kubevirt.io/v1</span><br><span class=\"line\">kind: VirtualMachine</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: myvm</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  running: false</span><br><span class=\"line\">  template:</span><br><span class=\"line\">    metadata:</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        kubevirt.io/domain: myvm</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      domain:</span><br><span class=\"line\">        devices:</span><br><span class=\"line\">          disks:</span><br><span class=\"line\">          - disk:</span><br><span class=\"line\">              bus: virtio</span><br><span class=\"line\">            name: containerdisk</span><br><span class=\"line\">          - disk:</span><br><span class=\"line\">              bus: virtio</span><br><span class=\"line\">            name: cloudinitdisk</span><br><span class=\"line\">        resources:</span><br><span class=\"line\">          requests:</span><br><span class=\"line\">            memory: 64M</span><br><span class=\"line\">      volumes:</span><br><span class=\"line\">      - name: containerdisk</span><br><span class=\"line\">        containerDisk:</span><br><span class=\"line\">          image: quay.io/kubevirt/cirros-container-disk-demo</span><br><span class=\"line\">      - name: cloudinitdisk</span><br><span class=\"line\">        cloudInitNoCloud:</span><br><span class=\"line\">          userData: |</span><br><span class=\"line\">            #cloud-config</span><br><span class=\"line\">            password: cirros</span><br><span class=\"line\">            chpasswd: &#123; expire: False &#125;</span><br><span class=\"line\">            ssh_pwauth: True</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>这个示例定义了一个简单的虚拟机，使用 CirrOS 镜像和 cloud-init 来配置初始用户。</p>\n<ol start=\"2\">\n<li><strong>创建虚拟机</strong></li>\n</ol>\n<p>使用以下命令创建虚拟机：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f vm.yaml</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><strong>启动虚拟机</strong></li>\n</ol>\n<p>使用 <code>virtctl</code> 启动虚拟机：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">virtctl start myvm</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li><strong>检查虚拟机状态</strong></li>\n</ol>\n<p>你可以使用以下命令检查虚拟机的状态：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get vms</span><br><span class=\"line\">kubectl get vmi</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ol start=\"5\">\n<li><strong>连接到虚拟机</strong></li>\n</ol>\n<p>使用 <code>virtctl</code> 连接到虚拟机的控制台：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">virtctl console myvm</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>通过以上步骤，你可以在 Kubernetes 集群上安装 KubeVirt，并创建和管理虚拟机。这包括安装 KubeVirt Operator 和 CR，配置并启动一个简单的虚拟机，以及使用 <code>virtctl</code> 工具进行管理。根据需要，你可以调整虚拟机的配置和资源请求，以满足不同的应用需求。</p>\n","text":"在 Kubernetes 集群上安装 KubeVirt安装 KubeVirt 并创建虚拟机可以按照以下步骤进行。 安装 KubeVirt 安装 KubeVirt...","permalink":"/post/OCI/在 Kubernetes 集群上安装 KubeVirt","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[{"name":"KubeVirt","slug":"KubeVirt","count":1,"path":"api/categories/KubeVirt.json"},{"name":"OCI","slug":"KubeVirt/OCI","count":1,"path":"api/categories/KubeVirt/OCI.json"}],"tags":[{"name":"安装","slug":"安装","count":1,"path":"api/tags/安装.json"},{"name":"virtctl","slug":"virtctl","count":1,"path":"api/tags/virtctl.json"},{"name":"Operator","slug":"Operator","count":1,"path":"api/tags/Operator.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%9C%A8-Kubernetes-%E9%9B%86%E7%BE%A4%E4%B8%8A%E5%AE%89%E8%A3%85-KubeVirt\"><span class=\"toc-text\">在 Kubernetes 集群上安装 KubeVirt</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85-KubeVirt\"><span class=\"toc-text\">安装 KubeVirt</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85-virtctl\"><span class=\"toc-text\">安装 virtctl</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E7%A4%BA%E4%BE%8B\"><span class=\"toc-text\">创建虚拟机的示例</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">总结</span></a></li></ol></li></ol></li></ol>","author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Kafka常用命令及遇到的问题","uid":"0bc98c01f2602afec20cfdc03ed2e502","slug":"MIDDLEWARE/Kafka常用命令及遇到的问题","date":"2024-12-07T16:14:25.000Z","updated":"2025-09-30T03:26:47.967Z","comments":true,"path":"api/articles/MIDDLEWARE/Kafka常用命令及遇到的问题.json","keywords":"XuGuangSheng","cover":"/covers/kafka.jpg","text":"Kafka常用命令及遇到的问题Kafka常用命令及可能遇到的问题： 启动Kafka代理服务器 命令：bin/kafka-server-start.sh conf...","permalink":"/post/MIDDLEWARE/Kafka常用命令及遇到的问题","photos":[],"count_time":{"symbolsCount":"8.3k","symbolsTime":"8 mins."},"categories":[{"name":"Kafka","slug":"Kafka","count":1,"path":"api/categories/Kafka.json"},{"name":"MIDDLEWARE","slug":"Kafka/MIDDLEWARE","count":1,"path":"api/categories/Kafka/MIDDLEWARE.json"}],"tags":[{"name":"topic","slug":"topic","count":2,"path":"api/tags/topic.json"},{"name":"命令","slug":"命令","count":1,"path":"api/tags/命令.json"},{"name":"问题","slug":"问题","count":1,"path":"api/tags/问题.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"mysql GTID主从复制故障后不停机恢复同步流程 - 塔克拉玛攻城狮 - 博客园","uid":"eb41994bab0b8b1a0fef2450d1035786","slug":"MIDDLEWARE/mysql GTID主从复制故障后不停机恢复同步流程 - 塔克拉玛攻城狮 - 博客园","date":"2024-08-19T15:11:26.000Z","updated":"2025-09-30T03:26:53.482Z","comments":true,"path":"api/articles/MIDDLEWARE/mysql GTID主从复制故障后不停机恢复同步流程 - 塔克拉玛攻城狮 - 博客园.json","keywords":"XuGuangSheng","cover":"/covers/mysql-gtid.jpg","text":"mysql GTID主从复制故障后不停机恢复同步流程 - 塔克拉玛攻城狮 - 博客园GTID实现主从复制数据同步 GTID是一个基于原始mysql服务器生成的一...","permalink":"/post/MIDDLEWARE/mysql GTID主从复制故障后不停机恢复同步流程 - 塔克拉玛攻城狮 - 博客园","photos":[],"count_time":{"symbolsCount":"12k","symbolsTime":"11 mins."},"categories":[{"name":"mysql","slug":"mysql","count":1,"path":"api/categories/mysql.json"},{"name":"MIDDLEWARE","slug":"mysql/MIDDLEWARE","count":1,"path":"api/categories/mysql/MIDDLEWARE.json"}],"tags":[{"name":"https","slug":"https","count":44,"path":"api/tags/https.json"},{"name":"assets","slug":"assets","count":1,"path":"api/tags/assets.json"},{"name":"cnblogs","slug":"cnblogs","count":1,"path":"api/tags/cnblogs.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}