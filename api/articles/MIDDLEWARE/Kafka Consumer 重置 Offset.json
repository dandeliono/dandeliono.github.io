{"title":"Kafka Consumer 重置 Offset","uid":"de6c24354e140e6b852bef14e54f1711","slug":"MIDDLEWARE/Kafka Consumer 重置 Offset","date":"2023-05-06T18:33:12.000Z","updated":"2025-12-05T01:47:27.262Z","comments":true,"path":"api/articles/MIDDLEWARE/Kafka Consumer 重置 Offset.json","keywords":"XuGuangSheng","cover":"/covers/kafka-consumer-offset.jpg","content":"<h1 id=\"Kafka-Consumer-重置-Offset\"><a href=\"#Kafka-Consumer-重置-Offset\" class=\"headerlink\" title=\"Kafka Consumer 重置 Offset\"></a>Kafka Consumer 重置 Offset</h1><p>在Kafka Version为0.11.0.0之后，Consumer的Offset信息不再默认保存在Zookeeper上，而是选择用Topic的形式保存下来。在命令行中可以使用kafka-consumer-groups的脚本实现Offset的相关操作。</p>\n<p><strong>更新Offset的三个维度：</strong> </p>\n<ul>\n<li><p>Topic的作用域</p>\n</li>\n<li><p>重置策略</p>\n</li>\n<li><p>执行方案</p>\n</li>\n<li><p>–all-topics：为consumer group下所有topic的所有分区调整位移）</p>\n</li>\n<li><p>–topic t1 –topic t2：为指定的若干个topic的所有分区调整位移</p>\n</li>\n<li><p>–topic t1:0,1,2：为指定的topic分区调整位移</p>\n</li>\n<li><p>–to-earliest：把位移调整到分区当前最小位移</p>\n</li>\n<li><p>–to-latest：把位移调整到分区当前最新位移</p>\n</li>\n<li><p>–to-current：把位移调整到分区当前位移</p>\n</li>\n<li><p>–to-offset <offset>： 把位移调整到指定位移处</p>\n</li>\n<li><p>–shift-by N： 把位移调整到当前位移 + N处，注意N可以是负数，表示向前移动</p>\n</li>\n<li><p>–to-datetime <datetime>：把位移调整到大于给定时间的最早位移处，datetime格式是yyyy-MM-ddTHH:mm:ss.xxx，比如2017-08-04T00:00:00.000</p>\n</li>\n<li><p>–by-duration <duration>：把位移调整到距离当前时间指定间隔的位移处，duration格式是PnDTnHnMnS，比如PT0H5M0S</p>\n</li>\n<li><p>–from-file <file>：从CSV文件中读取调整策略</p>\n</li>\n</ul>\n<p>什么参数都不加：只是打印出位移调整方案，不具体执行</p>\n<ul>\n<li>–execute：执行真正的位移调整</li>\n<li>–export：把位移调整方案按照CSV格式打印，方便用户成csv文件，供后续直接使用</li>\n</ul>\n<ol>\n<li><p>consumer group状态必须是inactive的，即不能是处于正在工作中的状态</p>\n</li>\n<li><p>不加执行方案，默认是只做打印操作</p>\n</li>\n<li><p>更新到当前group最初的offset位置</p>\n<figure class=\"highlight vbnet\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-consumer-groups.sh --bootstrap-server localhost:<span class=\"number\">9092</span> --<span class=\"keyword\">group</span> test-<span class=\"keyword\">group</span> --reset-offsets --all-topics --<span class=\"keyword\">to</span>-earliest --execute</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>更新到指定的offset位置</p>\n<figure class=\"highlight vbnet\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-consumer-groups.sh --bootstrap-server localhost:<span class=\"number\">9092</span> --<span class=\"keyword\">group</span> test-<span class=\"keyword\">group</span> --reset-offsets --all-topics --<span class=\"keyword\">to</span>-offset <span class=\"number\">500000</span> --execute</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>更新到当前offset位置（解决offset的异常）</p>\n<figure class=\"highlight vbnet\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-consumer-groups.sh --bootstrap-server localhost:<span class=\"number\">9092</span> --<span class=\"keyword\">group</span> test-<span class=\"keyword\">group</span> --reset-offsets --all-topics --<span class=\"keyword\">to</span>-current --execute</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>offset位置按设置的值进行位移</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-consumer-groups.sh --bootstrap-server localhost:<span class=\"number\">9092</span> --<span class=\"keyword\">group</span> test-<span class=\"keyword\">group</span> --reset-offsets --all-topics --shift-<span class=\"keyword\">by</span> <span class=\"number\">-100000</span> --execute</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>offset设置到指定时刻开始</p>\n<figure class=\"highlight vbnet\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-consumer-groups.sh --bootstrap-server localhost:<span class=\"number\">9092</span> --<span class=\"keyword\">group</span> test-<span class=\"keyword\">group</span> --reset-offsets --all-topics --<span class=\"keyword\">to</span>-datetime <span class=\"number\">2017</span>-<span class=\"number\">08</span>-<span class=\"number\">04</span>T14:<span class=\"number\">30</span>:<span class=\"number\">00.000</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n</ol>\n","text":"Kafka Consumer 重置 Offset在Kafka Version为0.11.0.0之后，Consumer的Offset信息不再默认保存在Zookee...","permalink":"/post/MIDDLEWARE/Kafka Consumer 重置 Offset","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"offset","slug":"offset","count":1,"path":"api/categories/offset.json"},{"name":"MIDDLEWARE","slug":"offset/MIDDLEWARE","count":1,"path":"api/categories/offset/MIDDLEWARE.json"}],"tags":[{"name":"consumer","slug":"consumer","count":2,"path":"api/tags/consumer.json"},{"name":"topic","slug":"topic","count":2,"path":"api/tags/topic.json"},{"name":"Offset","slug":"Offset","count":1,"path":"api/tags/Offset.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Kafka-Consumer-%E9%87%8D%E7%BD%AE-Offset\"><span class=\"toc-text\">Kafka Consumer 重置 Offset</span></a></li></ol>","author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Apache HttpClient使用不当导致的请求超时问题排查","uid":"f2f3d8a736517daef67fee74c45d8b64","slug":"JAVA/Apache HttpClient使用不当导致的请求超时问题排查","date":"2023-05-09T10:27:18.000Z","updated":"2025-12-05T01:46:10.354Z","comments":true,"path":"api/articles/JAVA/Apache HttpClient使用不当导致的请求超时问题排查.json","keywords":"XuGuangSheng","cover":"/covers/apache-httpclient.jpg","text":"Apache HttpClient使用不当导致的请求超时问题排查Apache HttpClient使用不当导致的请求超时问题排查 近期负责的线上应用出现调用失败...","permalink":"/post/JAVA/Apache HttpClient使用不当导致的请求超时问题排查","photos":[],"count_time":{"symbolsCount":"13k","symbolsTime":"12 mins."},"categories":[{"name":"HttpClient","slug":"HttpClient","count":1,"path":"api/categories/HttpClient.json"},{"name":"JAVA","slug":"HttpClient/JAVA","count":1,"path":"api/categories/HttpClient/JAVA.json"}],"tags":[{"name":"https","slug":"https","count":44,"path":"api/tags/https.json"},{"name":"com","slug":"com","count":26,"path":"api/tags/com.json"},{"name":"fbpfcp","slug":"fbpfcp","count":1,"path":"api/tags/fbpfcp.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Flux数据脚本语言","uid":"8ebea8637205b0f6626f1c002b32980b","slug":"MIDDLEWARE/Flux数据脚本语言","date":"2023-04-26T20:04:53.000Z","updated":"2025-12-05T01:47:26.547Z","comments":true,"path":"api/articles/MIDDLEWARE/Flux数据脚本语言.json","keywords":"XuGuangSheng","cover":"/covers/flux.jpg","text":"Flux数据脚本语言官方文档：Flux data scripting language | InfluxDB Enterprise 1.9 Documentat...","permalink":"/post/MIDDLEWARE/Flux数据脚本语言","photos":[],"count_time":{"symbolsCount":"110k","symbolsTime":"1:40"},"categories":[{"name":"Flux","slug":"Flux","count":1,"path":"api/categories/Flux.json"},{"name":"MIDDLEWARE","slug":"Flux/MIDDLEWARE","count":1,"path":"api/categories/Flux/MIDDLEWARE.json"}],"tags":[{"name":"使用","slug":"使用","count":5,"path":"api/tags/使用.json"},{"name":"time","slug":"time","count":1,"path":"api/tags/time.json"},{"name":"value","slug":"value","count":1,"path":"api/tags/value.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}