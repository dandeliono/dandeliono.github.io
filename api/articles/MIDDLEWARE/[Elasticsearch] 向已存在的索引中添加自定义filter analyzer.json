{"title":"[Elasticsearch] 向已存在的索引中添加自定义filter analyzer","uid":"2781e4b82126a200e2952c3286dd1c9d","slug":"MIDDLEWARE/[Elasticsearch] 向已存在的索引中添加自定义filter analyzer","date":"2021-12-02T15:03:01.000Z","updated":"2025-12-05T01:47:40.532Z","comments":true,"path":"api/articles/MIDDLEWARE/[Elasticsearch] 向已存在的索引中添加自定义filter analyzer.json","keywords":"XuGuangSheng","cover":"/covers/elasticsearch-filter-analyzer.jpg","content":"<h1 id=\"Elasticsearch-向已存在的索引中添加自定义filter-x2F-analyzer\"><a href=\"#Elasticsearch-向已存在的索引中添加自定义filter-x2F-analyzer\" class=\"headerlink\" title=\"[Elasticsearch] 向已存在的索引中添加自定义filter&#x2F;analyzer\"></a>[Elasticsearch] 向已存在的索引中添加自定义filter&#x2F;analyzer</h1><h2 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述\"></a>问题描述</h2><p>随着应用的不断升级，索引中的类型也会越来越多，新增加的类型中势必会使用到一些自定义的 Analyzer。但是通过_settings 端点的更新 API 不能直接在已经存在的索引上使用。在 sense 中进行更新时会抛出异常：</p>\n<figure class=\"highlight prolog\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">PUT</span> /symbol</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;settings&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;analysis&quot;</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;filter&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;edgengram&quot;</span>: &#123;</span><br><span class=\"line\">           <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;edgeNGram&quot;</span>,</span><br><span class=\"line\">           <span class=\"string\">&quot;min_gram&quot;</span>: <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">           <span class=\"string\">&quot;max_gram&quot;</span>: <span class=\"string\">&quot;255&quot;</span> &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"string\">&quot;analyzer&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;symbol_analyzer&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;custom&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;char_filter&quot;</span>: [],</span><br><span class=\"line\">          <span class=\"string\">&quot;tokenizer&quot;</span>: <span class=\"string\">&quot;standard&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;filter&quot;</span>: [ <span class=\"string\">&quot;lowercase&quot;</span>, <span class=\"string\">&quot;word_delimiter&quot;</span> ] &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;back_edge_ngram_analyzer&quot;</span>: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;custom&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;char_filter&quot;</span>: [],</span><br><span class=\"line\">          <span class=\"string\">&quot;tokenizer&quot;</span>: <span class=\"string\">&quot;whitespace&quot;</span>,</span><br><span class=\"line\">          <span class=\"string\">&quot;filter&quot;</span>: [ <span class=\"string\">&quot;reverse&quot;</span>, <span class=\"string\">&quot;edgengram&quot;</span>, <span class=\"string\">&quot;reverse&quot;</span> ] &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;<span class=\"string\">``</span><span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">上例中，我们希望向名为symbol的索引中添加一个filter和两个analyzers。但是会抛出如下的错误信息：</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br></pre></td></tr></table></figure>\n\n<p>{<br>   “error”: “IndexAlreadyExistsException[[symbol] already exists]”,”status”: 400<br>}```</p>\n<p>提示我们该索引已经存在了，无法添加。</p>\n<hr>\n<h2 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h2><p>最直观的解决方案是首先备份该索引中已经存在的数据，然后删除它再重建该索引。这种方式比较暴力，当索引中已经存在相当多的数据时，不建议这样做。</p>\n<p>另外一种方案是使用_open 和_close 这一对端点，首先将目标索引关闭，执行需要的更新操作，然后再打开该索引。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /symbol/_close</span><br><span class=\"line\"></span><br><span class=\"line\">PUT /symbol/_settings</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;settings&quot;: &#123;</span><br><span class=\"line\">    ....    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">POST /symbol/_open```</span><br><span class=\"line\"></span><br><span class=\"line\">这样就避免了需要重建索引的麻烦。有了新添加的filter和analyzer，就可以根据需要再对types中的mappings进行更新了。 </span><br><span class=\"line\"> [https://blog.csdn.net/dm_vincent/article/details/46996021](https://blog.csdn.net/dm_vincent/article/details/46996021)</span><br></pre></td></tr></table></figure>\n","text":"[Elasticsearch] 向已存在的索引中添加自定义filter/analyzer问题描述随着应用的不断升级，索引中的类型也会越来越多，新增加的类型中势必...","permalink":"/post/MIDDLEWARE/[Elasticsearch] 向已存在的索引中添加自定义filter analyzer","photos":[],"count_time":{"symbolsCount":"1.8k","symbolsTime":"2 mins."},"categories":[{"name":"symbol","slug":"symbol","count":1,"path":"api/categories/symbol.json"},{"name":"MIDDLEWARE","slug":"symbol/MIDDLEWARE","count":1,"path":"api/categories/symbol/MIDDLEWARE.json"}],"tags":[{"name":"settings","slug":"settings","count":1,"path":"api/tags/settings.json"},{"name":"filter","slug":"filter","count":1,"path":"api/tags/filter.json"},{"name":"POST","slug":"POST","count":1,"path":"api/tags/POST.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Elasticsearch-%E5%90%91%E5%B7%B2%E5%AD%98%E5%9C%A8%E7%9A%84%E7%B4%A2%E5%BC%95%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89filter-x2F-analyzer\"><span class=\"toc-text\">[Elasticsearch] 向已存在的索引中添加自定义filter&#x2F;analyzer</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0\"><span class=\"toc-text\">问题描述</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88\"><span class=\"toc-text\">解决方案</span></a></li></ol></li></ol>","author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Zookeeper开源客户端ZKClient和Curator简介","uid":"83a96f58bfaa8c716d7a61d4a063cd85","slug":"JAVA/Zookeeper开源客户端ZKClient和Curator简介","date":"2022-01-20T22:39:09.000Z","updated":"2025-12-05T01:46:40.312Z","comments":true,"path":"api/articles/JAVA/Zookeeper开源客户端ZKClient和Curator简介.json","keywords":"XuGuangSheng","cover":"/covers/zookeeperzkclientcurator.jpg","text":"Zookeeper开源客户端ZKClient和Curator简介Zookeeper 客户端提供了基本的操作，比如，创建会话、创建节点、读取节点、更新数据、删除节...","permalink":"/post/JAVA/Zookeeper开源客户端ZKClient和Curator简介","photos":[],"count_time":{"symbolsCount":930,"symbolsTime":"1 mins."},"categories":[{"name":"Zookeeper","slug":"Zookeeper","count":2,"path":"api/categories/Zookeeper.json"},{"name":"JAVA","slug":"Zookeeper/JAVA","count":2,"path":"api/categories/Zookeeper/JAVA.json"}],"tags":[{"name":"Curator","slug":"Curator","count":2,"path":"api/tags/Curator.json"},{"name":"API","slug":"API","count":1,"path":"api/tags/API.json"},{"name":"ZkClient","slug":"ZkClient","count":1,"path":"api/tags/ZkClient.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Linux 命令行编辑快捷键","uid":"a94b0501505e8b946dbe5622c7a78b56","slug":"LINUX/Linux 命令行编辑快捷键","date":"2021-11-26T16:59:24.000Z","updated":"2025-12-05T01:47:01.478Z","comments":true,"path":"api/articles/LINUX/Linux 命令行编辑快捷键.json","keywords":"XuGuangSheng","cover":"/covers/linux.jpg","text":"Linux 命令行编辑快捷键Linux 命令行编辑快捷键初学者在 Linux 命令窗口（终端）敲命令时，肯定觉得通过输入一串一串的字符的方式来控制计算是效率很低...","permalink":"/post/LINUX/Linux 命令行编辑快捷键","photos":[],"count_time":{"symbolsCount":"1.1k","symbolsTime":"1 mins."},"categories":[{"name":"Linux","slug":"Linux","count":1,"path":"api/categories/Linux.json"},{"name":"LINUX","slug":"Linux/LINUX","count":1,"path":"api/categories/Linux/LINUX.json"}],"tags":[{"name":"命令行编辑快捷键","slug":"命令行编辑快捷键","count":1,"path":"api/tags/命令行编辑快捷键.json"},{"name":"初学者在","slug":"初学者在","count":1,"path":"api/tags/初学者在.json"},{"name":"命令窗口","slug":"命令窗口","count":1,"path":"api/tags/命令窗口.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}