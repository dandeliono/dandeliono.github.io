{"title":"ZooKeeper报错Last transaction was partial","uid":"d80305d117df28e684a0a0d26ded383b","slug":"MIDDLEWARE/ZooKeeper报错Last transaction was partial","date":"2021-09-06T13:17:16.000Z","updated":"2025-09-30T03:26:50.653Z","comments":true,"path":"api/articles/MIDDLEWARE/ZooKeeper报错Last transaction was partial.json","keywords":"XuGuangSheng","cover":"/covers/zookeeperlast-transaction-was-partial.jpg","content":"<h1 id=\"ZooKeeper报错Last-transaction-was-partial\"><a href=\"#ZooKeeper报错Last-transaction-was-partial\" class=\"headerlink\" title=\"ZooKeeper报错Last transaction was partial\"></a>ZooKeeper报错Last transaction was partial</h1><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>Zookeeper 无法正常启动，报错 Last transaction was partial</p></blockquote>\n<pre><code>[2020-11-28 10:28:59,552] INFO Using org.apache.zookeeper.server.NIOServerCnxnFactory as server connection factory (org.apache.zookeeper.server.ServerCnxnFactory)\n[2020-11-28 10:28:59,556] INFO binding to port 0.0.0.0/0.0.0.0:2181 (org.apache.zookeeper.server.NIOServerCnxnFactory)\n[2020-11-28 10:28:59,588] ERROR Last transaction was partial. (org.apache.zookeeper.server.persistence.Util)\n[2020-11-28 10:28:59,589] ERROR Unexpected exception, exiting abnormally (org.apache.zookeeper.server.ZooKeeperServerMain)\njava.io.EOFException\n    at java.io.DataInputStream.readInt(DataInputStream.java:392)\n    at org.apache.jute.BinaryInputArchive.readInt(BinaryInputArchive.java:63)\n    at org.apache.zookeeper.server.persistence.FileHeader.deserialize(FileHeader.java:66)\n    at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.inStreamCreated(FileTxnLog.java:588)\n    at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.createInputArchive(FileTxnLog.java:607)\n    at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.goToNextLog(FileTxnLog.java:573)\n    at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.next(FileTxnLog.java:653)\n    at org.apache.zookeeper.server.persistence.FileTxnSnapLog.fastForwardFromEdits(FileTxnSnapLog.java:219)\n    at org.apache.zookeeper.server.persistence.FileTxnSnapLog.restore(FileTxnSnapLog.java:176)\n    at org.apache.zookeeper.server.ZKDatabase.loadDataBase(ZKDatabase.java:217)\n    at org.apache.zookeeper.server.ZooKeeperServer.loadData(ZooKeeperServer.java:284)\n    at org.apache.zookeeper.server.ZooKeeperServer.startdata(ZooKeeperServer.java:407)\n    at org.apache.zookeeper.server.NIOServerCnxnFactory.startup(NIOServerCnxnFactory.java:118)\n    at org.apache.zookeeper.server.ZooKeeperServerMain.runFromConfig(ZooKeeperServerMain.java:122)\n    at org.apache.zookeeper.server.ZooKeeperServerMain.initializeAndRun(ZooKeeperServerMain.java:89)\n    at org.apache.zookeeper.server.ZooKeeperServerMain.main(ZooKeeperServerMain.java:55)\n    at org.apache.zookeeper.server.quorum.QuorumPeerMain.initializeAndRun(QuorumPeerMain.java:119)\n    at org.apache.zookeeper.server.quorum.QuorumPeerMain.main(QuorumPeerMain.java:81) \n</code></pre>\n<p>（1）删除 ZooKeeper 安装目录下的 logs</p>\n<p>无效果</p>\n<p>（2）删除 ZooKeeper 的数据文件夹下大小为 0 的文件</p>\n<p>数据文件夹位置可以通过 zookeeper 的配置文件得到。</p>\n<pre><code># the directory where the snapshot is stored. dataDir=/tmp/zookeeper \n</code></pre>\n<p>删除该<code>[dataDir]/version-2/</code>下大小为 0 的快照文件，即可正常启动。</p>\n<p>（1）磁盘满了</p>\n<p>首先使用<code>du -h --max-depth=1</code>来逐层分析磁盘满的根本原因，比如我最终定位到 docker 文件夹，是因为 Docker 容器过多，需要将停止的容器清除，即可释放磁盘</p>\n<p>（2）ZooKeeper 快照无法写入（待考证）</p>\n<p>由于磁盘满，所以 ZooKeeper 无法将快照写入到磁盘，导致了大小为 0 的快照文件</p>\n<p>下次启动时，如果从快照中读取数据，就会出现<code>Last transaction was partial</code></p>\n<p> <a href=\"https://neyzoter.cn/2020/11/28/Zookeeper-Last-Transaction-Was-Partial/\">https://neyzoter.cn/2020/11/28/Zookeeper-Last-Transaction-Was-Partial/</a></p>\n","text":"ZooKeeper报错Last transaction was partial Zookeeper 无法正常启动，报错 Last transaction was...","permalink":"/post/MIDDLEWARE/ZooKeeper报错Last transaction was partial","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[{"name":"ZooKeeper","slug":"ZooKeeper","count":1,"path":"api/categories/ZooKeeper.json"},{"name":"MIDDLEWARE","slug":"ZooKeeper/MIDDLEWARE","count":1,"path":"api/categories/ZooKeeper/MIDDLEWARE.json"}],"tags":[{"name":"Last","slug":"Last","count":1,"path":"api/tags/Last.json"},{"name":"transaction","slug":"transaction","count":1,"path":"api/tags/transaction.json"},{"name":"was","slug":"was","count":1,"path":"api/tags/was.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#ZooKeeper%E6%8A%A5%E9%94%99Last-transaction-was-partial\"><span class=\"toc-text\">ZooKeeper报错Last transaction was partial</span></a></li></ol>","author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Linux 快捷键","uid":"bed926b9b5ce2da9bc2fbda11d1273e0","slug":"LINUX/Linux 快捷键","date":"2021-09-06T13:24:10.000Z","updated":"2025-09-30T03:26:33.174Z","comments":true,"path":"api/articles/LINUX/Linux 快捷键.json","keywords":"XuGuangSheng","cover":"/covers/linux.jpg","text":"Linux 快捷键最有用快捷键 Tab 命令或路径的补全键。应该是 Linux 最常用的快捷键，它将节省你 Linux 命令行中的大量时间。只需要输入一个命令，...","permalink":"/post/LINUX/Linux 快捷键","photos":[],"count_time":{"symbolsCount":"3.2k","symbolsTime":"3 mins."},"categories":[{"name":"Ctrl","slug":"Ctrl","count":1,"path":"api/categories/Ctrl.json"},{"name":"LINUX","slug":"Ctrl/LINUX","count":1,"path":"api/categories/Ctrl/LINUX.json"}],"tags":[{"name":"Alt","slug":"Alt","count":1,"path":"api/tags/Alt.json"},{"name":"Esc","slug":"Esc","count":1,"path":"api/tags/Esc.json"},{"name":"foo","slug":"foo","count":1,"path":"api/tags/foo.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"JSQLParser的简单使用","uid":"48d20d4467bd70f47406b938972138eb","slug":"JAVA/JSQLParser的简单使用","date":"2021-09-01T16:57:01.000Z","updated":"2025-09-30T03:26:11.368Z","comments":true,"path":"api/articles/JAVA/JSQLParser的简单使用.json","keywords":"XuGuangSheng","cover":"/covers/jsqlparser.jpg","text":"JSQLParser的简单使用这里简单记录一下最近了解到的 JSQLParser 这个 SQL 语句解析器的用法，方便有需要的时候参考。 正文：import n...","permalink":"/post/JAVA/JSQLParser的简单使用","photos":[],"count_time":{"symbolsCount":"4.1k","symbolsTime":"4 mins."},"categories":[{"name":"https","slug":"https","count":12,"path":"api/categories/https.json"},{"name":"JAVA","slug":"https/JAVA","count":5,"path":"api/categories/https/JAVA.json"}],"tags":[{"name":"com","slug":"com","count":26,"path":"api/tags/com.json"},{"name":"net","slug":"net","count":1,"path":"api/tags/net.json"},{"name":"www","slug":"www","count":8,"path":"api/tags/www.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}