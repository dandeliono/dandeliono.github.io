{"title":"Maven 私服 Nexus 升级实录","uid":"2d734239bc109a5925e2725830e859da","slug":"Maven 私服 Nexus 升级实录","date":"2025-09-28T16:12:32.000Z","updated":"2025-12-05T01:47:51.243Z","comments":true,"path":"api/articles/Maven 私服 Nexus 升级实录.json","keywords":"XuGuangSheng","cover":"/covers/maven-nexus.jpg","content":"<h1 id=\"Maven-私服-Nexus-升级实录\"><a href=\"#Maven-私服-Nexus-升级实录\" class=\"headerlink\" title=\"Maven 私服 Nexus 升级实录\"></a>Maven 私服 Nexus 升级实录</h1><h2 id=\"摘要\"><a href=\"#摘要\" class=\"headerlink\" title=\"摘要\"></a>摘要</h2><ul>\n<li><p>本文介绍 Mavne 私服 Nexus 升级的全过程，从 <code>3.29.2-02</code> 升级到 <code>3.83.2-01</code></p>\n</li>\n<li><p><a href=\"https://help.sonatype.com/en/sonatype-nexus-repository.html\">Nexus官网</a></p>\n</li>\n<li><p><a href=\"https://mirrors.tuna.tsinghua.edu.cn/Adoptium/\">OpenJdk下载地址</a></p>\n</li>\n<li><p><a href=\"https://help.sonatype.com/en/sonatype-nexus-repository-system-requirements.html\">Nexus系统配置要求</a></p>\n</li>\n</ul>\n<h2 id=\"升级过程说明\"><a href=\"#升级过程说明\" class=\"headerlink\" title=\"升级过程说明\"></a>升级过程说明</h2><ul>\n<li>Nexus 从 <code>3.71.x</code> 开始，不再支持 <code>OrientDB</code>，后续版本仅支持 <code>H2</code> 和 <code>PostgreSQL</code> ，根据<a href=\"https://help.sonatype.com/en/upgrading-to-nexus-repository-3-71-0-and-beyond.html\">官网说明</a>，<code>3.70.x</code> 以下的版本需要将 Nexus 先升级到 <code>3.70.x</code> 的最新版本，然后使用官方提供的数据库迁移工具，将数据库迁移到 <code>H2</code> 后，再升级到 <code>3.71.x</code> 以后的版本</li>\n</ul>\n<h2 id=\"从-3-29-2-02-升级到-nexus-3-70-4-02\"><a href=\"#从-3-29-2-02-升级到-nexus-3-70-4-02\" class=\"headerlink\" title=\"从 3.29.2-02 升级到 nexus-3.70.4-02\"></a>从 <code>3.29.2-02</code> 升级到 <code>nexus-3.70.4-02</code></h2><h3 id=\"安装-OpenJDK\"><a href=\"#安装-OpenJDK\" class=\"headerlink\" title=\"安装 OpenJDK\"></a>安装 <code>OpenJDK</code></h3><ul>\n<li>需要先安装好 <code>OpenJDK</code>，原因是<code>Nexus的数据库迁移工具</code>仅支持 <code>OpenJDK</code>，不支持 <code>Oracle JDK</code>，我这里选择安装 <code>OpenJDK11</code></li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local</span><br><span class=\"line\">curl -O https://mirrors.tuna.tsinghua.edu.cn/Adoptium/11/jdk/x64/linux/OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class=\"line\">tar -zxvf OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s /usr/local/jdk-11.0.28+6/bin/java /usr/bin/java</span><br><span class=\"line\"><span class=\"built_in\">export</span> JAVA_HOME=/usr/local/jdk-11.0.28+6</span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$JAVA_HOME</span>/bin:<span class=\"variable\">$PATH</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装-nexus-3-70-x\"><a href=\"#安装-nexus-3-70-x\" class=\"headerlink\" title=\"安装 nexus-3.70.x\"></a>安装 <code>nexus-3.70.x</code></h3><ul>\n<li><p>目前官网发布的<code>nexus-3.70.x</code>的最新版本为 <code>nexus-3.70.4-02</code>，<a href=\"https://help.sonatype.com/en/orientdb-downloads.html\">下载页面</a>，其对应的数据库迁移工具也可以从该页面下载。</p>\n</li>\n<li><p>这里我们选择 <a href=\"https://download.sonatype.com/nexus/3/nexus-3.70.4-02-java11-unix.tar.gz\">Java 11 的版本</a>，升级安装与第一次安装方式一样。</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">su - nexus</span><br><span class=\"line\"></span><br><span class=\"line\">sudo systemctl stop nexus</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">curl -O https://download.sonatype.com/nexus/3/nexus-3.70.4-02-java11-unix.tar.gz</span><br><span class=\"line\">tar -zxvf nexus-3.70.4-02-java11-unix.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -f ~/nexus3</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s /usr/local/nexus-3.70.4-02 ~/nexus3</span><br><span class=\"line\"></span><br><span class=\"line\">sudo systemctl start nexus</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"迁移数据到-H2\"><a href=\"#迁移数据到-H2\" class=\"headerlink\" title=\"迁移数据到 H2\"></a>迁移数据到 H2</h3><ul>\n<li>下载数据库迁移工具</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> ~/backup</span><br><span class=\"line\"><span class=\"built_in\">cd</span> ~/backup</span><br><span class=\"line\"></span><br><span class=\"line\">curl -O https://download.sonatype.com/nexus/nxrm3-migrator/nexus-db-migrator-3.70.4-02.jar</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>登录 Nexus 导出数据: 设置 -&gt; System -&gt; Tasks -&gt; Create task -&gt; Admin - Export databases for backup<br><a href=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/MS26e5.png\"><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/MS26e5.png\">\n</a></p>\n</li>\n<li><p>任务创建后点击<code>Run</code>，即可在 <code>/home/nexus/backup</code> 目录下看到备份文件</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ll /home/nexus/backup</span><br><span class=\"line\">-rw-rw-r-- 1 nexus nexus   121066 Sep  8 07:25 analytics-2025-09-08-07-25-57-3.70.4-02.bak</span><br><span class=\"line\">-rw-rw-r-- 1 nexus nexus 19349428 Sep  8 07:25 component-2025-09-08-07-25-57-3.70.4-02.bak</span><br><span class=\"line\">-rw-rw-r-- 1 nexus nexus   266208 Sep  8 07:25 config-2025-09-08-07-25-57-3.70.4-02.bak</span><br><span class=\"line\">-rw-r--r-- 1 nexus nexus 56809625 Sep  8 06:41 nexus-db-migrator-3.70.4-02.jar</span><br><span class=\"line\">-rw-rw-r-- 1 nexus nexus   132802 Sep  8 07:25 security-2025-09-08-07-25-57-3.70.4-02.bak</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>使用迁移工具生成H2数据库文件，官网参考资料: <a href=\"https://help.sonatype.com/en/migrating-to-a-new-database.html#migrating-from-orientdb-to-h2\">Migrating From OrientDB to H2</a></li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">sudo systemctl stop nexus</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /home/nexus/backup</span><br><span class=\"line\"></span><br><span class=\"line\">java -Xmx2G -Xms2G -XX:+UseG1GC -jar nexus-db-migrator-3.70.4-02.jar --migration_type=h2</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>运行成功后会生成 <code>nexus.mv.db</code>，将其移动到 <code>/home/nexus/sonatype-work/nexus3/db/</code> 目录下</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mv</span> nexus.mv.db /home/nexus/sonatype-work/nexus3/db/</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>编辑<code>/home/nexus/sonatype-work/nexus3/etc/nexus.properties</code> 文件，添加如下内容</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">nexus.datastore.enabled=<span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>启动 nexus，此时我们就完成了 从 <code>3.29.2-02</code> 到 <code>nexus-3.70.4-02</code> 的升级</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl start nexus</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"从-nexus-3-70-4-02-升级到-nexus-3-83-2-01\"><a href=\"#从-nexus-3-70-4-02-升级到-nexus-3-83-2-01\" class=\"headerlink\" title=\"从 nexus-3.70.4-02 升级到 nexus-3.83.2-01\"></a>从 <code>nexus-3.70.4-02</code> 升级到 <code>nexus-3.83.2-01</code></h2><ul>\n<li><p>这个升级就比较简单了，和我们此前的升级方式是一样的，下载解压后替换安装目录即可，这里要注意，从<code>nexus-3.71.0+</code>开始仅支持<code>jdk17</code>，所以需要提前安装好<code>jdk17</code>，另外从<code>nexus-3.78.0</code>开始，Nexus 内置了<code>openjdk17</code>，所以不需要再额外安装jdk。</p>\n</li>\n<li><p><code>nexus-3.83.2-01</code> 是目前的最新版，<a href=\"https://help.sonatype.com/en/download.html\">最新版下载页面</a>，<a href=\"https://help.sonatype.com/en/download-archives---repository-manager-3.html\">历史版本下载页面地址</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">sudo systemctl stop nexus</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cd</span> ~</span><br><span class=\"line\">curl -O https://download.sonatype.com/nexus/3/nexus-3.83.2-01-linux-x86_64.tar.gz</span><br><span class=\"line\">tar -zxvf nexus-3.83.2-01-linux-x86_64.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -f nexus3</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s nexus-3.83.2-01 nexus3</span><br><span class=\"line\"></span><br><span class=\"line\">sudo systemctl start nexus</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/rgLwWf.png\"><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/rgLwWf.png\">\n</a><br><a href=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/mdWh22.png\"><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/mdWh22.png\">\n</a><br><a href=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/56aOWz.png\"><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/56aOWz.png\">\n</a></p>\n","feature":true,"text":"Maven 私服 Nexus 升级实录摘要 本文介绍 Mavne 私服 Nexus 升级的全过程，从 3.29.2-02 升级到 3.83.2-01 Nexus...","permalink":"/post/Maven 私服 Nexus 升级实录","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[{"name":"nexus","slug":"nexus","count":1,"path":"api/categories/nexus.json"}],"tags":[{"name":"https","slug":"https","count":44,"path":"api/tags/https.json"},{"name":"com","slug":"com","count":26,"path":"api/tags/com.json"},{"name":"sonatype","slug":"sonatype","count":1,"path":"api/tags/sonatype.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Maven-%E7%A7%81%E6%9C%8D-Nexus-%E5%8D%87%E7%BA%A7%E5%AE%9E%E5%BD%95\"><span class=\"toc-text\">Maven 私服 Nexus 升级实录</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%91%98%E8%A6%81\"><span class=\"toc-text\">摘要</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8D%87%E7%BA%A7%E8%BF%87%E7%A8%8B%E8%AF%B4%E6%98%8E\"><span class=\"toc-text\">升级过程说明</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BB%8E-3-29-2-02-%E5%8D%87%E7%BA%A7%E5%88%B0-nexus-3-70-4-02\"><span class=\"toc-text\">从 3.29.2-02 升级到 nexus-3.70.4-02</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85-OpenJDK\"><span class=\"toc-text\">安装 OpenJDK</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85-nexus-3-70-x\"><span class=\"toc-text\">安装 nexus-3.70.x</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%81%E7%A7%BB%E6%95%B0%E6%8D%AE%E5%88%B0-H2\"><span class=\"toc-text\">迁移数据到 H2</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BB%8E-nexus-3-70-4-02-%E5%8D%87%E7%BA%A7%E5%88%B0-nexus-3-83-2-01\"><span class=\"toc-text\">从 nexus-3.70.4-02 升级到 nexus-3.83.2-01</span></a></li></ol></li></ol>","author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"使用 OpenRewrite 优化代码","uid":"f3ed7a9f2ae39ecacdf39c97b08052bb","slug":"使用 OpenRewrite 优化代码","date":"2025-12-02T14:30:55.000Z","updated":"2025-12-05T01:48:10.129Z","comments":true,"path":"api/articles/使用 OpenRewrite 优化代码.json","keywords":"XuGuangSheng","cover":"/covers/openrewrite.jpg","text":"使用 OpenRewrite 优化代码在 OpenJDK 21 升级指南 中提到， OpenRewrite 可以帮忙解决一些升级 OpenJDK 中发现的问题。...","permalink":"/post/使用 OpenRewrite 优化代码","photos":[],"count_time":{"symbolsCount":"5.3k","symbolsTime":"5 mins."},"categories":[{"name":"OpenRewrite","slug":"OpenRewrite","count":1,"path":"api/categories/OpenRewrite.json"}],"tags":[{"name":"Spring","slug":"Spring","count":1,"path":"api/tags/Spring.json"},{"name":"Java","slug":"Java","count":2,"path":"api/tags/Java.json"},{"name":"JUnit","slug":"JUnit","count":1,"path":"api/tags/JUnit.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"定制Ubuntu安装镜像的两种方法","uid":"4944cfccd2356072e58570e06c390077","slug":"LINUX/定制Ubuntu安装镜像的两种方法","date":"2025-08-07T16:44:08.000Z","updated":"2025-12-05T01:47:16.531Z","comments":true,"path":"api/articles/LINUX/定制Ubuntu安装镜像的两种方法.json","keywords":"XuGuangSheng","cover":"/covers/ubuntu.jpg","text":"定制Ubuntu安装镜像的两种方法1. 准备工作1234- 确保你有一个Ubuntu工作站或虚拟机来进行定制工作。- 确保你的系统已经更新： ```bash s...","permalink":"/post/LINUX/定制Ubuntu安装镜像的两种方法","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[{"name":"ISO","slug":"ISO","count":1,"path":"api/categories/ISO.json"},{"name":"LINUX","slug":"ISO/LINUX","count":1,"path":"api/categories/ISO/LINUX.json"}],"tags":[{"name":"sudo","slug":"sudo","count":1,"path":"api/tags/sudo.json"},{"name":"bash","slug":"bash","count":1,"path":"api/tags/bash.json"},{"name":"Cubic","slug":"Cubic","count":1,"path":"api/tags/Cubic.json"}],"author":{"name":"dandeliono","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/29496357","link":"/","description":"永远相信美好的事情即将发生","socials":{"github":"https://github.com/dandeliono","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}